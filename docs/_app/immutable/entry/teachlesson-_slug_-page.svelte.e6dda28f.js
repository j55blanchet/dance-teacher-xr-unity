var dt=Object.defineProperty;var mt=(s,t,e)=>t in s?dt(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var Ce=(s,t,e)=>(mt(s,typeof t!="symbol"?t+"":t,e),e);import{S as ge,i as be,s as Ee,k as S,l as D,m as T,h as u,n as w,b as C,I as fe,P as We,q as B,r as H,D as b,a as M,c as U,Q as qe,R as we,N as Y,J as Ie,T as ye,u as de,v as Fe,d as $,f as Oe,g as Z,H as nt,K as ot,o as Ve,t as ht,w as se,y as he,z as _e,A as pe,B as ve,M as Se,p as re,e as Be,L as _t,U as Pe,V as ct,O as pt,W as He,X as vt}from"../chunks/index.705b31cf.js";import{g as ut,l as gt}from"../chunks/dances-store.ad2855c4.js";import{G as bt,P as X}from"../chunks/mediapipe-utils.945eca67.js";import{w as Te,a as Et,R as Ge,P as je,D as kt,b as wt}from"../chunks/VirtualMirror.svelte_svelte_type_style_lang.a6c88837.js";import"../chunks/index.2defaa64.js";function ze(s,t,e){const i=s.slice();return i[11]=t[e],i}function Ye(s,t,e){const i=s.slice();return i[11]=t[e],i}function St(s){let t,e;return{c(){t=S("div"),e=B("Webcam Started")},l(i){t=D(i,"DIV",{});var r=T(t);e=H(r,"Webcam Started"),r.forEach(u)},m(i,r){C(i,t,r),b(t,e)},p:fe,d(i){i&&u(t)}}}function Dt(s){let t,e,i,r,l,a,c,n,d,h,f,m,p,g,_,R,N,V,y=s[3],E=[];for(let o=0;o<y.length;o+=1)E[o]=Xe(Ye(s,y,o));let O=s[4],I=[];for(let o=0;o<O.length;o+=1)I[o]=Qe(ze(s,O,o));return{c(){t=S("label"),e=B("Video Devices"),i=M(),r=S("select");for(let o=0;o<E.length;o+=1)E[o].c();l=M(),a=S("div"),c=M(),n=S("label"),d=B("Audio Devices"),h=M(),f=S("select");for(let o=0;o<I.length;o+=1)I[o].c();m=M(),p=S("div"),g=M(),_=S("button"),R=B("Start Webcam"),this.h()},l(o){t=D(o,"LABEL",{for:!0});var P=T(t);e=H(P,"Video Devices"),P.forEach(u),i=U(o),r=D(o,"SELECT",{name:!0,class:!0});var v=T(r);for(let W=0;W<E.length;W+=1)E[W].l(v);v.forEach(u),l=U(o),a=D(o,"DIV",{class:!0}),T(a).forEach(u),c=U(o),n=D(o,"LABEL",{for:!0});var F=T(n);d=H(F,"Audio Devices"),F.forEach(u),h=U(o),f=D(o,"SELECT",{name:!0,class:!0});var q=T(f);for(let W=0;W<I.length;W+=1)I[W].l(q);q.forEach(u),m=U(o),p=D(o,"DIV",{class:!0}),T(p).forEach(u),g=U(o),_=D(o,"BUTTON",{class:!0});var Q=T(_);R=H(Q,"Start Webcam"),Q.forEach(u),this.h()},h(){w(t,"for","videoDevices"),w(r,"name","videoDevices"),w(r,"class","outlined thin"),s[6]===void 0&&qe(()=>s[9].call(r)),w(a,"class","spacer svelte-1n7z142"),w(n,"for","audioDevices"),w(f,"name","audioDevices"),w(f,"class","outlined thin"),s[5]===void 0&&qe(()=>s[10].call(f)),w(p,"class","spacer svelte-1n7z142"),w(_,"class","button outlined thin")},m(o,P){C(o,t,P),b(t,e),C(o,i,P),C(o,r,P);for(let v=0;v<E.length;v+=1)E[v]&&E[v].m(r,null);we(r,s[6],!0),C(o,l,P),C(o,a,P),C(o,c,P),C(o,n,P),b(n,d),C(o,h,P),C(o,f,P);for(let v=0;v<I.length;v+=1)I[v]&&I[v].m(f,null);we(f,s[5],!0),C(o,m,P),C(o,p,P),C(o,g,P),C(o,_,P),b(_,R),N||(V=[Y(r,"change",s[9]),Y(f,"change",s[10]),Y(_,"click",s[8])],N=!0)},p(o,P){if(P&8){y=o[3];let v;for(v=0;v<y.length;v+=1){const F=Ye(o,y,v);E[v]?E[v].p(F,P):(E[v]=Xe(F),E[v].c(),E[v].m(r,null))}for(;v<E.length;v+=1)E[v].d(1);E.length=y.length}if(P&72&&we(r,o[6]),P&16){O=o[4];let v;for(v=0;v<O.length;v+=1){const F=ze(o,O,v);I[v]?I[v].p(F,P):(I[v]=Qe(F),I[v].c(),I[v].m(f,null))}for(;v<I.length;v+=1)I[v].d(1);I.length=O.length}P&48&&we(f,o[5])},d(o){o&&u(t),o&&u(i),o&&u(r),Ie(E,o),o&&u(l),o&&u(a),o&&u(c),o&&u(n),o&&u(h),o&&u(f),Ie(I,o),o&&u(m),o&&u(p),o&&u(g),o&&u(_),N=!1,ye(V)}}}function It(s){let t,e,i,r,l;return{c(){t=S("div"),e=S("div"),i=M(),r=S("p"),l=B(s[1]),this.h()},l(a){t=D(a,"DIV",{class:!0});var c=T(t);e=D(c,"DIV",{class:!0}),T(e).forEach(u),i=U(c),r=D(c,"P",{});var n=T(r);l=H(n,s[1]),n.forEach(u),c.forEach(u),this.h()},h(){w(e,"class","spinner large margin-auto"),w(t,"class","ta-center")},m(a,c){C(a,t,c),b(t,e),b(t,i),b(t,r),b(r,l)},p(a,c){c&2&&de(l,a[1])},d(a){a&&u(t)}}}function Pt(s){let t,e,i,r,l,a,c=s[2]&&Je(s);return{c(){t=S("div"),e=S("button"),i=B("Start Webcam"),r=M(),c&&c.c(),this.h()},l(n){t=D(n,"DIV",{class:!0});var d=T(t);e=D(d,"BUTTON",{id:!0,class:!0});var h=T(e);i=H(h,"Start Webcam"),h.forEach(u),r=U(d),c&&c.l(d),d.forEach(u),this.h()},h(){w(e,"id","startWebcam"),w(e,"class","button outlined thin"),w(t,"class","ta-center")},m(n,d){C(n,t,d),b(t,e),b(e,i),b(t,r),c&&c.m(t,null),l||(a=Y(e,"click",s[7]),l=!0)},p(n,d){n[2]?c?c.p(n,d):(c=Je(n),c.c(),c.m(t,null)):c&&(c.d(1),c=null)},d(n){n&&u(t),c&&c.d(),l=!1,a()}}}function Xe(s){let t,e=s[11].label+"",i,r;return{c(){t=S("option"),i=B(e),this.h()},l(l){t=D(l,"OPTION",{});var a=T(t);i=H(a,e),a.forEach(u),this.h()},h(){t.__value=r=s[11].deviceId,t.value=t.__value},m(l,a){C(l,t,a),b(t,i)},p(l,a){a&8&&e!==(e=l[11].label+"")&&de(i,e),a&8&&r!==(r=l[11].deviceId)&&(t.__value=r,t.value=t.__value)},d(l){l&&u(t)}}}function Qe(s){let t,e=s[11].label+"",i,r;return{c(){t=S("option"),i=B(e),this.h()},l(l){t=D(l,"OPTION",{});var a=T(t);i=H(a,e),a.forEach(u),this.h()},h(){t.__value=r=s[11].deviceId,t.value=t.__value},m(l,a){C(l,t,a),b(t,i)},p(l,a){a&16&&e!==(e=l[11].label+"")&&de(i,e),a&16&&r!==(r=l[11].deviceId)&&(t.__value=r,t.value=t.__value)},d(l){l&&u(t)}}}function Je(s){var c;let t,e,i,r,l=((c=s[2])==null?void 0:c.message)+"",a;return{c(){t=S("div"),e=S("p"),i=B("Failed to start webcam: "),r=S("code"),a=B(l),this.h()},l(n){t=D(n,"DIV",{class:!0});var d=T(t);e=D(d,"P",{class:!0});var h=T(e);i=H(h,"Failed to start webcam: "),r=D(h,"CODE",{});var f=T(r);a=H(f,l),f.forEach(u),h.forEach(u),d.forEach(u),this.h()},h(){w(e,"class","svelte-1n7z142"),w(t,"class","error svelte-1n7z142")},m(n,d){C(n,t,d),b(t,e),b(e,i),b(e,r),b(r,a)},p(n,d){var h;d&4&&l!==(l=((h=n[2])==null?void 0:h.message)+"")&&de(a,l)},d(n){n&&u(t)}}}function Tt(s){let t;function e(l,a){if(l[0]==="start")return Pt;if(l[0]==="busy")return It;if(l[0]==="devicelist")return Dt;if(l[0]==="success")return St}let i=e(s),r=i&&i(s);return{c(){t=S("div"),r&&r.c(),this.h()},l(l){t=D(l,"DIV",{class:!0});var a=T(t);r&&r.l(a),a.forEach(u),this.h()},h(){w(t,"class","webcamSelector svelte-1n7z142")},m(l,a){C(l,t,a),r&&r.m(t,null)},p(l,[a]){i===(i=e(l))&&r?r.p(l,a):(r&&r.d(1),r=i&&i(l),r&&(r.c(),r.m(t,null)))},i:fe,o:fe,d(l){l&&u(t),r&&r.d()}}}function yt(s,t,e){let i="start",r="",l,a=[],c=[],n,d;async function h(){e(0,i="busy"),e(2,l=void 0),e(1,r="Detecting Devices...");try{const g=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),_=await navigator.mediaDevices.enumerateDevices();if(e(3,a=_.filter(R=>R.kind==="videoinput")),e(4,c=_.filter(R=>R.kind==="audioinput")),a.length===0){e(0,i="start"),e(2,l=new Error("No devices found"));return}if(a.length===1){Te.set(g),e(0,i="success");return}e(6,d=a[0].deviceId),e(5,n=c[0].deviceId),e(0,i="devicelist")}catch(g){e(2,l=g),e(0,i="start");return}}async function f(){e(2,l=void 0),e(0,i="busy"),e(1,r="Starting Webcam...");try{const g=await navigator.mediaDevices.getUserMedia({video:{deviceId:d},audio:{deviceId:n}});Te.set(g),e(0,i="success")}catch(g){e(2,l=g),e(0,i="devicelist")}}function m(){d=We(this),e(6,d),e(3,a)}function p(){n=We(this),e(5,n),e(4,c)}return[i,r,l,a,c,n,d,h,f,m,p]}class Nt extends ge{constructor(t){super(),be(this,t,yt,Tt,Ee,{})}}function At(s){let t,e,i;return e=new Nt({}),{c(){t=S("div"),he(e.$$.fragment)},l(r){t=D(r,"DIV",{});var l=T(t);_e(e.$$.fragment,l),l.forEach(u)},m(r,l){C(r,t,l),pe(e,t,null),i=!0},p:fe,i(r){i||(Z(e.$$.fragment,r),i=!0)},o(r){$(e.$$.fragment,r),i=!1},d(r){r&&u(t),ve(e)}}}function Rt(s){let t,e,i,r,l;return{c(){t=S("video"),e=M(),i=S("canvas"),this.h()},l(a){t=D(a,"VIDEO",{class:!0}),T(t).forEach(u),e=U(a),i=D(a,"CANVAS",{class:!0}),T(i).forEach(u),this.h()},h(){t.autoplay=!0,w(t,"class","svelte-eu68uy"),w(i,"class","svelte-eu68uy")},m(a,c){C(a,t,c),s[21](t),t.muted=s[0],C(a,e,c),C(a,i,c),s[23](i),r||(l=[Y(t,"play",s[6]),Y(t,"loadeddata",s[5]),Y(t,"volumechange",s[22])],r=!0)},p(a,c){c[0]&1&&(t.muted=a[0])},i:fe,o:fe,d(a){a&&u(t),s[21](null),a&&u(e),a&&u(i),s[23](null),r=!1,ye(l)}}}function Ct(s){let t,e,i,r;const l=[Rt,At],a=[];function c(n,d){return n[3]?0:1}return e=c(s),i=a[e]=l[e](s),{c(){t=S("div"),i.c(),this.h()},l(n){t=D(n,"DIV",{class:!0});var d=T(t);i.l(d),d.forEach(u),this.h()},h(){w(t,"class","wrapper svelte-eu68uy")},m(n,d){C(n,t,d),a[e].m(t,null),s[24](t),r=!0},p(n,d){let h=e;e=c(n),e===h?a[e].p(n,d):(Fe(),$(a[h],1,1,()=>{a[h]=null}),Oe(),i=a[e],i?i.p(n,d):(i=a[e]=l[e](n),i.c()),Z(i,1),i.m(t,null))},i(n){r||(Z(i),r=!0)},o(n){$(i),r=!1},d(n){n&&u(t),a[e].d(),s[24](null)}}}function Vt(s){var t=getComputedStyle(s);return[s.clientWidth-parseFloat(t.paddingLeft)-parseFloat(t.paddingRight),s.clientHeight-parseFloat(t.paddingTop)-parseFloat(t.paddingBottom)]}function Ft(s,t,e){let i;nt(s,Te,k=>e(3,i=k));const r=-1e3,l=ot();let{poseEstimationEnabled:a=!1}=t,{drawSkeleton:c=!1}=t,{muted:n=!0}=t,{poseEstimationCheckFunction:d=()=>!0}=t,h=null,f,{poseEstimationPrimedPromise:m=new Promise(k=>f=k)}=t,p=!1,g,_,R,N,V,y;const E=new Promise(k=>y=k);let O=new Date().getTime(),I=-1,o=-1,P=1,v=1,F=1,q=1,Q=1,W=1;function le(){g&&(e(17,P=g.videoWidth),e(18,v=g.videoHeight))}let G=null;const J=()=>{_&&(W>F?(e(2,_.height=Q,_),e(2,_.width=Q*F,_)):(e(2,_.width=q,_),e(2,_.height=q/F,_)))};function te(){return e(14,h=Et),e(14,h.onmessage=k=>{if(k.data.type===Ge.poseEstimation){if(k.data.frameId===r){f==null||f();return}const j=bt(k.data.result,(_==null?void 0:_.width)??1,(_==null?void 0:_.height)??1);o=k.data.frameId,G=k.data.result,l("poseEstimationResult",{frameId:k.data.frameId,result:k.data.result,pixelLMs:j})}else k.data.type===Ge.error&&(console.error(k.data.error),k.data.frameId===I&&(I=-1,G=null))},h),h.ready}async function ae(){if(!a||!h||!N||!_)throw new Error("Pose estimation not enabled, or not yet ready.");return console.log("Priming pose estimation"),e(7,m=new Promise(k=>f=k)),h.postMessage({type:je.requestPoseEstimation,frameId:r,image:N.getImageData(0,0,_.width,_.height)}),m}Ve(async()=>{a&&te(),await ht(),J();const k=new ResizeObserver(j=>{if(!R)return;const[z,x]=Vt(R);e(19,q=z),e(20,Q=x)});return k.observe(R),()=>{h==null||h.terminate(),k.unobserve(R)}});function K(){!g||!i||(e(1,g.srcObject=i,g),e(15,p=!0),y&&(y(),y=void 0))}let A=0;function ee(){if(!_||!g||!i||!N)return;A+=1;const k=g.videoWidth/g.videoHeight,j=_.width/_.height;let z=_.width,x=_.height,ce=0,ue=0;if(k>j?(x=_.width/k,ue=(_.height-x)/2):(z=x*k,ce=(_.width-z)/2),N.drawImage(g,ce,ue,z,x),!(ce>=0&&ue>=0&&z>0&&x>0&&j>0&&k>0)){requestAnimationFrame(ee);return}if(o==I&&a&&d()){const ie=new Date().getTime()-O;I=A,l("poseEstimationFrameSent",{frameId:A,timestampMs:ie}),h==null||h.postMessage({type:je.requestPoseEstimation,frameId:A,timestampMs:ie,image:N.getImageData(ce,ue,z,x)})}if(!c){requestAnimationFrame(ee);return}N.save();for(const ie of(G==null?void 0:G.landmarks)??[])V==null||V.drawConnectors(ie,wt.POSE_CONNECTIONS),V==null||V.drawLandmarks(ie,{radius:me=>5});N.restore(),requestAnimationFrame(ee)}Ve(()=>(K(),{}));function ne(k){se[k?"unshift":"push"](()=>{g=k,e(1,g)})}function oe(){n=this.muted,e(0,n)}function Ne(k){se[k?"unshift":"push"](()=>{_=k,e(2,_)})}function L(k){se[k?"unshift":"push"](()=>{R=k,e(4,R)})}return s.$$set=k=>{"poseEstimationEnabled"in k&&e(8,a=k.poseEstimationEnabled),"drawSkeleton"in k&&e(9,c=k.drawSkeleton),"muted"in k&&e(0,n=k.muted),"poseEstimationCheckFunction"in k&&e(10,d=k.poseEstimationCheckFunction),"poseEstimationPrimedPromise"in k&&e(7,m=k.poseEstimationPrimedPromise)},s.$$.update=()=>{s.$$.dirty[0]&393216&&(F=P/v),s.$$.dirty[0]&1572864&&(W=q/Q),s.$$.dirty[0]&16640&&a&&!h&&te(),s.$$.dirty[0]&10&&i&&g&&K(),s.$$.dirty[0]&1966080&&P&&v&&q&&Q&&J(),s.$$.dirty[0]&98310&&p&&g&&_&&(e(16,N=_.getContext("2d",{willReadFrequently:!0})),V=new kt(N),ee())},[n,g,_,i,R,le,J,m,a,c,d,E,te,ae,h,p,N,P,v,q,Q,ne,oe,Ne,L]}class Ot extends ge{constructor(t){super(),be(this,t,Ft,Ct,Ee,{poseEstimationEnabled:8,drawSkeleton:9,muted:0,poseEstimationCheckFunction:10,poseEstimationPrimedPromise:7,webcamStartedPromise:11,setupPoseEstimation:12,primePoseEstimation:13},null,[-1,-1])}get webcamStartedPromise(){return this.$$.ctx[11]}get setupPoseEstimation(){return this.$$.ctx[12]}get primePoseEstimation(){return this.$$.ctx[13]}}function Ke(s,t,e){const i=s.slice();return i[11]=t[e],i}function Ze(s,t,e){const i=s.slice();return i[14]=t[e],i}function xe(s){let t;return{c(){t=S("span"),this.h()},l(e){t=D(e,"SPAN",{class:!0,style:!0});var i=T(t);i.forEach(u),this.h()},h(){w(t,"class","progress outlined svelte-g9xqg2"),re(t,"width",s[5]*100+"%")},m(e,i){C(e,t,i)},p(e,i){i&32&&re(t,"width",e[5]*100+"%")},d(e){e&&u(t)}}}function $e(s){let t;return{c(){t=S("span"),this.h()},l(e){t=D(e,"SPAN",{class:!0,style:!0});var i=T(t);i.forEach(u),this.h()},h(){w(t,"class","beat-line svelte-g9xqg2"),re(t,"left",(s[14]-s[2].start_time)/(s[2].end_time-s[2].start_time)*100+"%")},m(e,i){C(e,t,i)},p(e,i){i&20&&re(t,"left",(e[14]-e[2].start_time)/(e[2].end_time-e[2].start_time)*100+"%")},d(e){e&&u(t)}}}function et(s){let t,e=s[14]>s[2].start_time&&s[14]<s[2].end_time&&$e(s);return{c(){e&&e.c(),t=Be()},l(i){e&&e.l(i),t=Be()},m(i,r){e&&e.m(i,r),C(i,t,r)},p(i,r){i[14]>i[2].start_time&&i[14]<i[2].end_time?e?e.p(i,r):(e=$e(i),e.c(),e.m(t.parentNode,t)):e&&(e.d(1),e=null)},d(i){e&&e.d(i),i&&u(t)}}}function tt(s){let t,e,i=s[2].children,r=[];for(let a=0;a<i.length;a+=1)r[a]=it(Ke(s,i,a));const l=a=>$(r[a],1,1,()=>{r[a]=null});return{c(){t=S("div");for(let a=0;a<r.length;a+=1)r[a].c();this.h()},l(a){t=D(a,"DIV",{class:!0});var c=T(t);for(let n=0;n<r.length;n+=1)r[n].l(c);c.forEach(u),this.h()},h(){w(t,"class","children svelte-g9xqg2")},m(a,c){C(a,t,c);for(let n=0;n<r.length;n+=1)r[n]&&r[n].m(t,null);e=!0},p(a,c){if(c&31){i=a[2].children;let n;for(n=0;n<i.length;n+=1){const d=Ke(a,i,n);r[n]?(r[n].p(d,c),Z(r[n],1)):(r[n]=it(d),r[n].c(),Z(r[n],1),r[n].m(t,null))}for(Fe(),n=i.length;n<r.length;n+=1)l(n);Oe()}},i(a){if(!e){for(let c=0;c<i.length;c+=1)Z(r[c]);e=!0}},o(a){r=r.filter(Boolean);for(let c=0;c<r.length;c+=1)$(r[c]);e=!1},d(a){a&&u(t),Ie(r,a)}}}function it(s){let t,e;return t=new ft({props:{node:s[11],enableClick:s[0],currentTime:s[1],showProgressNodes:s[3],beatTimes:s[4]}}),t.$on("nodeClicked",s[8]),{c(){he(t.$$.fragment)},l(i){_e(t.$$.fragment,i)},m(i,r){pe(t,i,r),e=!0},p(i,r){const l={};r&4&&(l.node=i[11]),r&1&&(l.enableClick=i[0]),r&2&&(l.currentTime=i[1]),r&8&&(l.showProgressNodes=i[3]),r&16&&(l.beatTimes=i[4]),t.$set(l)},i(i){e||(Z(t.$$.fragment,i),e=!0)},o(i){$(t.$$.fragment,i),e=!1},d(i){ve(t,i)}}}function Lt(s){let t,e,i,r,l,a,c,n=s[6]&&xe(s),d=s[4],h=[];for(let m=0;m<d.length;m+=1)h[m]=et(Ze(s,d,m));let f=s[2].children.length>0&&tt(s);return{c(){t=S("div"),e=S("a"),n&&n.c(),i=M();for(let m=0;m<h.length;m+=1)h[m].c();r=M(),f&&f.c(),this.h()},l(m){t=D(m,"DIV",{class:!0,style:!0});var p=T(t);e=D(p,"A",{class:!0});var g=T(e);n&&n.l(g),i=U(g);for(let _=0;_<h.length;_+=1)h[_].l(g);g.forEach(u),r=U(p),f&&f.l(p),p.forEach(u),this.h()},h(){w(e,"class","bar outlined svelte-g9xqg2"),Se(e,"button",s[0]),Se(e,"active",s[6]),w(t,"class","node svelte-g9xqg2"),re(t,"--node-duration",s[2].end_time-s[2].start_time)},m(m,p){C(m,t,p),b(t,e),n&&n.m(e,null),b(e,i);for(let g=0;g<h.length;g+=1)h[g]&&h[g].m(e,null);b(t,r),f&&f.m(t,null),l=!0,a||(c=Y(e,"click",s[7]),a=!0)},p(m,[p]){if(m[6]?n?n.p(m,p):(n=xe(m),n.c(),n.m(e,i)):n&&(n.d(1),n=null),p&20){d=m[4];let g;for(g=0;g<d.length;g+=1){const _=Ze(m,d,g);h[g]?h[g].p(_,p):(h[g]=et(_),h[g].c(),h[g].m(e,null))}for(;g<h.length;g+=1)h[g].d(1);h.length=d.length}(!l||p&1)&&Se(e,"button",m[0]),(!l||p&64)&&Se(e,"active",m[6]),m[2].children.length>0?f?(f.p(m,p),p&4&&Z(f,1)):(f=tt(m),f.c(),Z(f,1),f.m(t,null)):f&&(Fe(),$(f,1,1,()=>{f=null}),Oe()),(!l||p&4)&&re(t,"--node-duration",m[2].end_time-m[2].start_time)},i(m){l||(Z(f),l=!0)},o(m){$(f),l=!1},d(m){m&&u(t),n&&n.d(),Ie(h,m),f&&f.d(),a=!1,c()}}}function Mt(s,t,e){let{enableClick:i=!1}=t,{currentTime:r=0}=t,{node:l}=t,{showProgressNodes:a=[]}=t,{beatTimes:c=[]}=t,n=0,d=!1;const h=ot();function f(){i&&h("nodeClicked",l)}function m(p){_t.call(this,s,p)}return s.$$set=p=>{"enableClick"in p&&e(0,i=p.enableClick),"currentTime"in p&&e(1,r=p.currentTime),"node"in p&&e(2,l=p.node),"showProgressNodes"in p&&e(3,a=p.showProgressNodes),"beatTimes"in p&&e(4,c=p.beatTimes)},s.$$.update=()=>{s.$$.dirty&6&&e(5,n=(r-l.start_time)/(l.end_time-l.start_time)),s.$$.dirty&4&&l.id.split("-").findLast(()=>!0),s.$$.dirty&12&&e(6,d=a.includes(l))},[i,r,l,a,c,n,d,f,m]}class ft extends ge{constructor(t){super(),be(this,t,Mt,Lt,Ee,{enableClick:0,currentTime:1,node:2,showProgressNodes:3,beatTimes:4})}}const Ut=Object.freeze([[X.leftShoulder,X.rightShoulder],[X.leftShoulder,X.leftHip],[X.leftHip,X.rightHip],[X.rightHip,X.rightShoulder],[X.leftShoulder,X.leftElbow],[X.leftElbow,X.leftWrist],[X.rightShoulder,X.rightElbow],[X.rightElbow,X.rightWrist]]);function st(s,t,e){const{x:i,y:r}=s[t],l=Math.pow(Math.pow(i,2)+Math.pow(r,2),.5);return[i/l,r/l]}function Wt(s,t){let e=0;for(const f of Ut){const[m,p]=f,[g,_]=st(s,m),[R,N]=st(t,m),[V,y]=[g-R,_-N];e+=Math.abs(V)||0,e+=Math.abs(y)||0}const i=18,r=15,l=i-r,a=5,n=a-0,d=(e-r)/l,h=a-n*d;return[e,h]}class qt{constructor(){Ce(this,"tracks",new Map)}recordEvaluationFrame(t,e,i,r){var n;const l=Object.keys(r);this.tracks.has(t)||this.tracks.set(t,{creationDate:new Date,frameTimes:[],userPoses:[],evaluation:l.reduce((d,h)=>(d[h]=[],d),{})});const a=((n=this.tracks.get(t))==null?void 0:n.frameTimes.slice(-1)[0])??-1/0;if(e<=a)throw new Error("Frame time must be increasing");const c=this.tracks.get(t);c.frameTimes.push(e),c.userPoses.push(i);for(const d of l)c.evaluation[d].push(r[d])}}class Bt{constructor(t){Ce(this,"recorder",new qt);this.referenceData=t}evaluateFrame(t,e,i){const r=this.referenceData.getReferencePoseAtTime(e);if(!r){this.recorder.recordEvaluationFrame(t,e,i,{rawQijiaDissimilarityScore:NaN,qijiaPerformanceScore:NaN,julienScore:NaN});return}const[l,a]=Wt(r,i);this.recorder.recordEvaluationFrame(t,e,i,{rawQijiaDissimilarityScore:l,qijiaPerformanceScore:a,julienScore:NaN})}}function rt(s){let t,e,i;return{c(){t=S("div"),e=S("span"),i=B(s[12]),this.h()},l(r){t=D(r,"DIV",{class:!0});var l=T(t);e=D(l,"SPAN",{class:!0});var a=T(e);i=H(a,s[12]),a.forEach(u),l.forEach(u),this.h()},h(){w(e,"class","count svelte-1i1odcu"),w(t,"class","countdown svelte-1i1odcu")},m(r,l){C(r,t,l),b(t,e),b(e,i)},p(r,l){l[0]&4096&&de(i,r[12])},d(r){r&&u(t)}}}function lt(s){var p,g,_,R;let t,e,i,r,l,a,c,n,d=JSON.stringify((R=(_=(g=(p=s[10])==null?void 0:p.recorder)==null?void 0:g.tracks)==null?void 0:_.get(s[11]))==null?void 0:R.evaluation,void 0,2)+"",h,f,m;return{c(){t=S("div"),e=S("h1"),i=B("Feedback"),r=M(),l=S("button"),a=B("Play Again"),c=M(),n=S("pre"),h=B(d),this.h()},l(N){t=D(N,"DIV",{class:!0});var V=T(t);e=D(V,"H1",{});var y=T(e);i=H(y,"Feedback"),y.forEach(u),r=U(V),l=D(V,"BUTTON",{class:!0});var E=T(l);a=H(E,"Play Again"),E.forEach(u),c=U(V),n=D(V,"PRE",{});var O=T(n);h=H(O,d),O.forEach(u),V.forEach(u),this.h()},h(){w(l,"class","button outlined thin"),w(t,"class","svelte-1i1odcu")},m(N,V){C(N,t,V),b(t,e),b(e,i),b(t,r),b(t,l),b(l,a),b(t,c),b(t,n),b(n,h),f||(m=Y(l,"click",s[0]),f=!0)},p(N,V){var y,E,O,I;V[0]&3072&&d!==(d=JSON.stringify((I=(O=(E=(y=N[10])==null?void 0:y.recorder)==null?void 0:E.tracks)==null?void 0:O.get(N[11]))==null?void 0:I.evaluation,void 0,2)+"")&&de(h,d)},d(N){N&&u(t),f=!1,m()}}}function at(s){let t,e,i,r,l;return{c(){t=S("div"),e=S("div"),i=M(),r=S("div"),l=B("Loading..."),this.h()},l(a){t=D(a,"DIV",{class:!0});var c=T(t);e=D(c,"DIV",{class:!0}),T(e).forEach(u),i=U(c),r=D(c,"DIV",{class:!0});var n=T(r);l=H(n,"Loading..."),n.forEach(u),c.forEach(u),this.h()},h(){w(e,"class","spinner large"),w(r,"class","label svelte-1i1odcu"),w(t,"class","loading outlined thick svelte-1i1odcu")},m(a,c){C(a,t,c),b(t,e),b(t,i),b(t,r),b(r,l)},d(a){a&&u(t)}}}function Ht(s){let t,e,i,r,l,a=!1,c,n=!0,d,h,f,m,p,g,_,R,N;function V(){cancelAnimationFrame(c),i.paused||(c=ct(V),a=!0),s[23].call(i)}let y=s[12]>=0&&rt(s),E=s[1]==="feedback"&&lt(s),O={poseEstimationEnabled:s[9],drawSkeleton:!s[4]||s[5],poseEstimationCheckFunction:s[14]};p=new Ot({props:O}),s[26](p),p.$on("poseEstimationFrameSent",s[13]),p.$on("poseEstimationResult",s[15]);let I=s[1]==="waitStart"&&at();return{c(){t=S("section"),e=S("div"),i=S("video"),r=S("source"),d=M(),y&&y.c(),h=M(),E&&E.c(),f=M(),m=S("div"),he(p.$$.fragment),g=M(),I&&I.c(),this.h()},l(o){t=D(o,"SECTION",{class:!0});var P=T(t);e=D(P,"DIV",{class:!0});var v=T(e);i=D(v,"VIDEO",{class:!0});var F=T(i);r=D(F,"SOURCE",{src:!0,type:!0}),F.forEach(u),d=U(v),y&&y.l(v),v.forEach(u),h=U(P),E&&E.l(P),f=U(P),m=D(P,"DIV",{class:!0});var q=T(m);_e(p.$$.fragment,q),g=U(q),I&&I.l(q),q.forEach(u),P.forEach(u),this.h()},h(){Pe(r.src,l=s[8])||w(r,"src",l),w(r,"type","video/mp4"),w(i,"class","shrinkingVideo svelte-1i1odcu"),w(e,"class","svelte-1i1odcu"),w(m,"class","svelte-1i1odcu"),re(m,"display",s[1]==="feedback"?"none":"flex"),w(t,"class","svelte-1i1odcu")},m(o,P){C(o,t,P),b(t,e),b(e,i),b(i,r),s[22](i),isNaN(s[7])||(i.playbackRate=s[7]),b(e,d),y&&y.m(e,null),b(t,h),E&&E.m(t,null),b(t,f),b(t,m),pe(p,m,null),b(m,g),I&&I.m(m,null),_=!0,R||(N=[Y(i,"timeupdate",V),Y(i,"ratechange",s[24]),Y(i,"play",s[25]),Y(i,"pause",s[25])],R=!0)},p(o,P){(!_||P[0]&256&&!Pe(r.src,l=o[8]))&&w(r,"src",l),!a&&P[0]&8&&!isNaN(o[3])&&(i.currentTime=o[3]),a=!1,P[0]&128&&!isNaN(o[7])&&(i.playbackRate=o[7]),P[0]&16&&n!==(n=o[4])&&i[n?"pause":"play"](),o[12]>=0?y?y.p(o,P):(y=rt(o),y.c(),y.m(e,null)):y&&(y.d(1),y=null),o[1]==="feedback"?E?E.p(o,P):(E=lt(o),E.c(),E.m(t,f)):E&&(E.d(1),E=null);const v={};P[0]&512&&(v.poseEstimationEnabled=o[9]),P[0]&48&&(v.drawSkeleton=!o[4]||o[5]),p.$set(v),o[1]==="waitStart"?I||(I=at(),I.c(),I.m(m,null)):I&&(I.d(1),I=null),P[0]&2&&re(m,"display",o[1]==="feedback"?"none":"flex")},i(o){_||(Z(p.$$.fragment,o),_=!0)},o(o){$(p.$$.fragment,o),_=!1},d(o){o&&u(t),s[22](null),y&&y.d(),E&&E.d(),s[26](null),ve(p),I&&I.d(),R=!1,ye(N)}}}async function De(s){return new Promise(t=>{setTimeout(t,(s??1)*1e3)})}function Gt(s,t,e){let i;nt(s,Te,A=>e(21,i=A));let{dance:r}=t,{practiceActivity:l}=t,a="waitWebcam",c=0,n="watch",d=1,{pageActive:h=!1}=t,f,m,p=0,g=1,_=!0,R="",N=!1,V=null,y=null,E=null,O=crypto.randomUUID(),I=-1,o=!1;async function P(){o||(N&&(console.log("Triggering pose estimation priming"),await m.primePoseEstimation()),e(1,a="playing"),e(11,O=crypto.randomUUID()),e(5,o=!0),f&&(f.pause(),e(2,f.currentTime=(l==null?void 0:l.startTime)??0,f)),e(12,I=5),await De(d),e(12,I=6),await De(d),e(12,I=7),await De(d),e(12,I=8),await De(d),e(12,I=-1),f&&f.play(),e(5,o=!1))}async function v(){e(19,c=0),e(1,a="waitWebcam"),f&&(f.pause(),e(2,f.currentTime=(l==null?void 0:l.startTime)??0,f)),await m.webcamStartedPromise,e(1,a="waitStart"),y=await gt(r),e(10,E=new Bt(y)),await V,P()}let F=new Map,q=-1;function Q(A){console.log("poseEstimationFrameSent",A.detail.frameId,f.currentTime),F.set(A.detail.frameId,f.currentTime),q=f.currentTime}function W(){return q!==f.currentTime}function le(A){var oe;if(console.log("poseEstimationFrameReceived",A.detail.frameId,A.detail.result),!y){console.log("No dance pose information",A);return}if(!F.has(A.detail.frameId)){console.log(`No matching correspondance for ${A.detail.frameId}`,A,"current correspondances: ",F);return}const ee=F.get(A.detail.frameId);F.delete(A.detail.frameId);const ne=((oe=A==null?void 0:A.detail)==null?void 0:oe.pixelLMs)??null;ne&&(E==null||E.evaluateFrame(O,ee,ne))}Ve(()=>(e(2,f.currentTime=(l==null?void 0:l.startTime)??0,f),V=m.setupPoseEstimation(),{}));function G(A){se[A?"unshift":"push"](()=>{f=A,e(2,f)})}function J(){p=this.currentTime,e(3,p)}function te(){g=this.playbackRate,e(7,g),e(17,l)}function ae(){_=this.paused,e(4,_)}function K(A){se[A?"unshift":"push"](()=>{m=A,e(6,m)})}return s.$$set=A=>{"dance"in A&&e(16,r=A.dance),"practiceActivity"in A&&e(17,l=A.practiceActivity),"pageActive"in A&&e(18,h=A.pageActive)},s.$$.update=()=>{s.$$.dirty[0]&655360&&l&&e(20,n=l.activityTypes[c]),s.$$.dirty[0]&65536&&(d=r!=null&&r.bpm?60/r.bpm:1),s.$$.dirty[0]&65536&&e(8,R=ut(r)),s.$$.dirty[0]&1310768&&e(9,N=h&&(o||!_)&&n==="drill"),s.$$.dirty[0]&131072&&e(7,g=(l==null?void 0:l.playbackSpeed)??1),s.$$.dirty[0]&131084&&(l!=null&&l.endTime&&p>=l.endTime||p>=(f==null?void 0:f.duration))&&(f.pause(),e(1,a="feedback")),s.$$.dirty[0]&2097154&&i&&a==="waitWebcam"&&e(1,a="waitStart")},[v,a,f,p,_,o,m,g,R,N,E,O,I,Q,W,le,r,l,h,c,n,i,G,J,te,ae,K]}class jt extends ge{constructor(t){super(),be(this,t,Gt,Ht,Ee,{dance:16,practiceActivity:17,pageActive:18,reset:0},null,[-1,-1])}get reset(){return this.$$.ctx[0]}}function zt(s,t,e,i){return{startTime:e.start_time,endTime:e.end_time,activityTypes:["drill"],playbackSpeed:.6}}function Yt(s){let t,e,i,r,l,a,c,n,d,h=s[9].title+"",f,m,p,g,_,R,N,V,y,E,O,I,o=!1,P,v,F,q,Q,W,le,G,J,te,ae,K,A,ee,ne;document.title=t="Dance | "+s[9].title,N=new ft({props:{enableClick:!0,node:s[10].root,showProgressNodes:s[6],currentTime:s[1],beatTimes:s[9].beatTimes||[]}}),N.$on("nodeClicked",s[11]);function oe(){cancelAnimationFrame(P),E.paused||(P=ct(oe),o=!0),s[15].call(E)}let Ne={dance:s[9],practiceActivity:s[7],pageActive:s[8]};return K=new jt({props:Ne}),s[19](K),{c(){e=S("meta"),i=M(),r=S("section"),l=S("nav"),a=S("a"),c=B("< Go Home"),n=M(),d=S("h1"),f=B(h),m=M(),p=S("div"),g=M(),_=S("div"),R=S("div"),he(N.$$.fragment),V=M(),y=S("div"),E=S("video"),O=S("source"),v=M(),F=S("div"),q=S("label"),Q=B(`Playback Speed\r
                `),W=S("input"),le=M(),G=S("dialog"),J=S("button"),te=B("X"),ae=M(),he(K.$$.fragment),this.h()},l(L){const k=pt("svelte-1jmxnxe",document.head);e=D(k,"META",{name:!0,content:!0}),k.forEach(u),i=U(L),r=D(L,"SECTION",{class:!0});var j=T(r);l=D(j,"NAV",{});var z=T(l);a=D(z,"A",{class:!0,href:!0});var x=T(a);c=H(x,"< Go Home"),x.forEach(u),n=U(z),d=D(z,"H1",{class:!0});var ce=T(d);f=H(ce,h),ce.forEach(u),m=U(z),p=D(z,"DIV",{});var ue=T(p);ue.forEach(u),z.forEach(u),g=U(j),_=D(j,"DIV",{class:!0});var Ae=T(_);R=D(Ae,"DIV",{class:!0});var ie=T(R);_e(N.$$.fragment,ie),ie.forEach(u),Ae.forEach(u),V=U(j),y=D(j,"DIV",{class:!0});var me=T(y);E=D(me,"VIDEO",{class:!0});var Le=T(E);O=D(Le,"SOURCE",{src:!0,type:!0}),Le.forEach(u),v=U(me),F=D(me,"DIV",{class:!0});var Me=T(F);q=D(Me,"LABEL",{});var Re=T(q);Q=H(Re,`Playback Speed\r
                `),W=D(Re,"INPUT",{type:!0,name:!0,min:!0,max:!0,step:!0}),Re.forEach(u),Me.forEach(u),me.forEach(u),le=U(j),G=D(j,"DIALOG",{id:!0,class:!0});var ke=T(G);J=D(ke,"BUTTON",{class:!0,"aria-label":!0});var Ue=T(J);te=H(Ue,"X"),Ue.forEach(u),ae=U(ke),_e(K.$$.fragment,ke),ke.forEach(u),j.forEach(u),this.h()},h(){w(e,"name","description"),w(e,"content","App for learning the dance: "+s[9].title),w(a,"class","button"),w(a,"href","/"),w(d,"class","title"),w(R,"class","svelte-2k31ke"),w(_,"class","visual-tree svelte-2k31ke"),Pe(O.src,I=s[2])||w(O,"src",I),w(O,"type","video/mp4"),w(E,"class","svelte-2k31ke"),w(W,"type","range"),w(W,"name","playbackSpeed"),w(W,"min","0.5"),w(W,"max","2"),w(W,"step","0.1"),w(F,"class","controls"),w(y,"class","preview svelte-2k31ke"),w(J,"class","button outlined thin close svelte-2k31ke"),w(J,"aria-label","Close"),w(G,"id","practicePage"),w(G,"class","svelte-2k31ke"),w(r,"class","svelte-2k31ke")},m(L,k){b(document.head,e),C(L,i,k),C(L,r,k),b(r,l),b(l,a),b(a,c),b(l,n),b(l,d),b(d,f),b(l,m),b(l,p),b(r,g),b(r,_),b(_,R),pe(N,R,null),b(r,V),b(r,y),b(y,E),b(E,O),s[14](E),isNaN(s[5])||(E.playbackRate=s[5]),b(y,v),b(y,F),b(F,q),b(q,Q),b(q,W),He(W,s[5]),b(r,le),b(r,G),b(G,J),b(J,te),b(G,ae),pe(K,G,null),s[20](G),A=!0,ee||(ne=[Y(E,"timeupdate",oe),Y(E,"ratechange",s[16]),Y(W,"change",s[17]),Y(W,"input",s[17]),Y(J,"click",s[18])],ee=!0)},p(L,[k]){(!A||k&512)&&t!==(t="Dance | "+L[9].title)&&(document.title=t);const j={};k&64&&(j.showProgressNodes=L[6]),k&2&&(j.currentTime=L[1]),N.$set(j),(!A||k&4&&!Pe(O.src,I=L[2]))&&w(O,"src",I),!o&&k&2&&!isNaN(L[1])&&(E.currentTime=L[1]),o=!1,k&32&&!isNaN(L[5])&&(E.playbackRate=L[5]),k&32&&He(W,L[5]);const z={};k&128&&(z.practiceActivity=L[7]),k&256&&(z.pageActive=L[8]),K.$set(z)},i(L){A||(Z(N.$$.fragment,L),Z(K.$$.fragment,L),A=!0)},o(L){$(N.$$.fragment,L),$(K.$$.fragment,L),A=!1},d(L){u(e),L&&u(i),L&&u(r),ve(N),s[14](null),s[19](null),ve(K),s[20](null),ee=!1,ye(ne)}}}function Xt(s,t,e){let{data:i}=t;const r=i.dance,l=i.danceTree;let a="",c,n,d,h=1/0,f=0,m=1,p=null,g=[],_=null,R=!1;async function N(v){console.log("node clicked",v.detail);const F=v.detail;e(13,p=F),e(7,_=zt(r,l,F)),n&&(d.reset(),n.showModal(),e(8,R=!0))}function V(v){se[v?"unshift":"push"](()=>{c=v,e(0,c)})}function y(){f=this.currentTime,e(1,f)}function E(){m=this.playbackRate,e(5,m)}function O(){m=vt(this.value),e(5,m)}const I=()=>{e(8,R=!1),n.close()};function o(v){se[v?"unshift":"push"](()=>{d=v,e(4,d)})}function P(v){se[v?"unshift":"push"](()=>{n=v,e(3,n)})}return s.$$set=v=>{"data"in v&&e(12,i=v.data)},s.$$.update=()=>{s.$$.dirty&8192&&e(6,g=p!==null?[p]:[]),s.$$.dirty&3&&f>h&&c.pause()},e(2,a=ut(r)),[c,f,a,n,d,m,g,_,R,r,l,N,i,p,V,y,E,O,I,o,P]}class ei extends ge{constructor(t){super(),be(this,t,Xt,Yt,Ee,{data:12})}}export{ei as default};
