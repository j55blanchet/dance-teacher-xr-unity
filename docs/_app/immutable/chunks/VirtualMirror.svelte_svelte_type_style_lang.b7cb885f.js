var p=Object.defineProperty;var l=(t,s,e)=>s in t?p(t,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[s]=e;var i=(t,s,e)=>(l(t,typeof s!="symbol"?s+"":s,e),e);import{P as h}from"./vision_bundle.f4284cec.js";import{w as c}from"./index.6fdacd77.js";const u=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]));var w=(t=>(t.poseEstimation="poseEstimation",t.error="error",t.resetComplete="resetComplete",t.resetError="resetError",t))(w||{}),n=(t=>(t.requestPoseEstimation="requestPoseEstimation",t.reset="reset",t))(n||{});async function m(){const t=await u(),s="/mediapipe",e={wasmLoaderPath:`${s}/vision_wasm_nosimd_internal.js`,wasmBinaryPath:`${s}/vision_wasm_nosimd_internal.wasm`};t&&(e.wasmLoaderPath=`${s}/vision_wasm_internal.js`,e.wasmBinaryPath=`${s}/vision_wasm_internal.wasm`);const r="VIDEO";return await h.createFromOptions(e,{baseOptions:{modelAssetPath:"/mediapipe/pose_landmarker_lite.task",delegate:"GPU"},runningMode:r,numPoses:2})}class y{constructor(){i(this,"poseLandmarker",null);i(this,"onmessage",()=>{});i(this,"ready");i(this,"responseFunctions",new Map);this.ready=new Promise(async(s,e)=>{try{this.poseLandmarker=await m(),s()}catch(r){e(r)}}),this.responseFunctions.set("requestPoseEstimation",this.handlePoseEstimationRequest.bind(this)),this.responseFunctions.set("reset",this.handleReset.bind(this))}postMessage(s){var a;let e=s;const r=(e==null?void 0:e.frameId)??-1;if(!e||!e.type){this.respondWithError(r,"Invalid message format");return}if(!Object.values(n).includes(e.type)){this.respondWithError(r,"Invalid message type: "+e.type+". The valid types are: "+Object.values(n).join(", "));return}(a=this.responseFunctions.get(e.type))==null||a(r,e)}handleReset(s,e){var r;(r=this.poseLandmarker)==null||r.close(),this.poseLandmarker=null,this.ready=new Promise(async(a,d)=>{try{this.poseLandmarker=await m(),a(),this.respondWithMessage("resetComplete",s,{})}catch(o){d(o),this.respondWithMessage("resetError",s,{error:o})}})}handlePoseEstimationRequest(s,e){if(!this.poseLandmarker){this.respondWithError(s,"PoseLandmarker not initialized");return}if(!e.image||!e.timestampMs){this.respondWithError(s,"Missing image or timestampMs property");return}const r=this.poseLandmarker.detectForVideo(e.image,e.timestampMs);this.respondWithMessage("poseEstimation",s,{result:r})}respondWithMessage(s,e,r){let a={...r,frameId:e,type:s};a={data:a},this.onmessage(a)}respondWithError(s,e){this.respondWithMessage("error",s,{error:e})}terminate(){var s;(s=this.poseLandmarker)==null||s.close()}}const k=new y,v=c(null);export{n as P,w as R,k as a,v as w};
