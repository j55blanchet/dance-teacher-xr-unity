var l=Object.defineProperty;var p=(t,s,e)=>s in t?l(t,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[s]=e;var a=(t,s,e)=>(p(t,typeof s!="symbol"?s+"":s,e),e);import{P as h}from"./vision_bundle.f4284cec.js";import{w as c}from"./index.6fdacd77.js";const u=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]));var w=(t=>(t.poseEstimation="poseEstimation",t.error="error",t.resetComplete="resetComplete",t.resetError="resetError",t))(w||{}),n=(t=>(t.requestPoseEstimation="requestPoseEstimation",t.reset="reset",t))(n||{});async function d(){const t=await u(),s="/mediapipe",e={wasmLoaderPath:`${s}/vision_wasm_nosimd_internal.js`,wasmBinaryPath:`${s}/vision_wasm_nosimd_internal.wasm`};t&&(e.wasmLoaderPath=`${s}/vision_wasm_internal.js`,e.wasmBinaryPath=`${s}/vision_wasm_internal.wasm`);const r="VIDEO";return await h.createFromOptions(e,{baseOptions:{modelAssetPath:"/mediapipe/pose_landmarker_lite.task",delegate:"GPU"},runningMode:r,numPoses:2})}class y{constructor(){a(this,"poseLandmarker",null);a(this,"onmessage",()=>{});a(this,"ready");a(this,"responseFunctions",new Map);this.ready=new Promise(async(s,e)=>{try{this.poseLandmarker=await d(),s()}catch(r){e(r)}}),this.responseFunctions.set("requestPoseEstimation",this.handlePoseEstimationRequest.bind(this)),this.responseFunctions.set("reset",this.handleReset.bind(this))}postMessage(s){var i;let e=s;const r=(e==null?void 0:e.frameId)??-1;if(!e||!e.type){this.respondWithError(r,"Invalid message format");return}if(!Object.values(n).includes(e.type)){this.respondWithError(r,"Invalid message type: "+e.type+". The valid types are: "+Object.values(n).join(", "));return}(i=this.responseFunctions.get(e.type))==null||i(r,e)}handleReset(s,e){var r;(r=this.poseLandmarker)==null||r.close(),this.poseLandmarker=null,this.ready=new Promise(async(i,o)=>{try{this.poseLandmarker=await d(),i(),this.respondWithMessage("resetComplete",s,{})}catch(m){o(m),this.respondWithMessage("resetError",s,{error:m})}})}handlePoseEstimationRequest(s,e){if(!this.poseLandmarker){this.respondWithError(s,"PoseLandmarker not initialized");return}if(!e.image||!e.timestampMs){this.respondWithError(s,"Missing image or timestampMs property");return}const r=this.poseLandmarker.detectForVideo(e.image,e.timestampMs),o=((r==null?void 0:r.landmarks)??[])[0]??null;this.respondWithMessage("poseEstimation",s,{landmarkerResult:r,estimatedPose:o,srcWidth:e.image.width,srcHeight:e.image.height})}respondWithMessage(s,e,r){let i={...r,frameId:e,type:s};i={data:i},this.onmessage(i)}respondWithError(s,e){this.respondWithMessage("error",s,{error:e})}terminate(){var s;(s=this.poseLandmarker)==null||s.close()}}const k=new y,v=c(null);export{n as P,w as R,k as a,v as w};
