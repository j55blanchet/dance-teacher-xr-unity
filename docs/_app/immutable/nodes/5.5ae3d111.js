var Zt=Object.defineProperty;var Xt=(n,e,t)=>e in n?Zt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var qe=(n,e,t)=>(Xt(n,typeof e!="symbol"?e+"":e,t),t);import{D as Ye,P as Qt,e as lt}from"../chunks/index.04079824.js";import{g as xt,f as $t,c as en,b as tn,l as nn,m as at}from"../chunks/dances-store.8daf6854.js";import{S as Ee,i as Te,s as De,k as O,l as R,m as V,h as m,n as v,b as A,I as fe,W as ct,q as L,r as z,D as k,a as q,c as G,X as ut,Y as Ve,N as ce,J as Fe,R as Qe,u as ee,v as Ut,d as se,f as Wt,g as oe,H as Ie,K as xe,o as He,t as on,w as de,y as ve,z as ye,A as we,B as Se,M as Me,Z as $e,e as dt,_ as et,T as Oe,p as ft,U as Re,V as ht}from"../chunks/index.63361c4d.js";import{a as rn,V as sn,g as ln}from"../chunks/VideoWithSkeleton.2819482f.js";import{e as an,b as cn,f as un,a as dn,p as fn,d as hn}from"../chunks/settings.f2d99c93.js";import{P as Je,a as W,S as mn,G as mt,M as gn}from"../chunks/mediapipe-utils.7a327831.js";import{l as Ke}from"../chunks/math.c86fcf30.js";import{w as Be,a as gt,R as je,P as Ge}from"../chunks/VirtualMirror.svelte_svelte_type_style_lang.c4235c89.js";function pt(n,e,t){const o=n.slice();return o[11]=e[t],o}function _t(n,e,t){const o=n.slice();return o[11]=e[t],o}function pn(n){let e,t;return{c(){e=O("div"),t=L("Webcam Started")},l(o){e=R(o,"DIV",{});var r=V(e);t=z(r,"Webcam Started"),r.forEach(m)},m(o,r){A(o,e,r),k(e,t)},p:fe,d(o){o&&m(e)}}}function _n(n){let e,t,o,r,i,s,l,a,c,f,g,p,D,P,E,_,H,I,C=n[3],y=[];for(let d=0;d<C.length;d+=1)y[d]=bt(_t(n,C,d));let w=n[4],B=[];for(let d=0;d<w.length;d+=1)B[d]=vt(pt(n,w,d));return{c(){e=O("label"),t=L("Video Devices"),o=q(),r=O("select");for(let d=0;d<y.length;d+=1)y[d].c();i=q(),s=O("div"),l=q(),a=O("label"),c=L("Audio Devices"),f=q(),g=O("select");for(let d=0;d<B.length;d+=1)B[d].c();p=q(),D=O("div"),P=q(),E=O("button"),_=L("Start Webcam"),this.h()},l(d){e=R(d,"LABEL",{for:!0});var u=V(e);t=z(u,"Video Devices"),u.forEach(m),o=G(d),r=R(d,"SELECT",{name:!0,class:!0});var h=V(r);for(let N=0;N<y.length;N+=1)y[N].l(h);h.forEach(m),i=G(d),s=R(d,"DIV",{class:!0}),V(s).forEach(m),l=G(d),a=R(d,"LABEL",{for:!0});var b=V(a);c=z(b,"Audio Devices"),b.forEach(m),f=G(d),g=R(d,"SELECT",{name:!0,class:!0});var T=V(g);for(let N=0;N<B.length;N+=1)B[N].l(T);T.forEach(m),p=G(d),D=R(d,"DIV",{class:!0}),V(D).forEach(m),P=G(d),E=R(d,"BUTTON",{class:!0});var U=V(E);_=z(U,"Start Webcam"),U.forEach(m),this.h()},h(){v(e,"for","videoDevices"),v(r,"name","videoDevices"),v(r,"class","outlined thin"),n[6]===void 0&&ut(()=>n[9].call(r)),v(s,"class","spacer svelte-1n7z142"),v(a,"for","audioDevices"),v(g,"name","audioDevices"),v(g,"class","outlined thin"),n[5]===void 0&&ut(()=>n[10].call(g)),v(D,"class","spacer svelte-1n7z142"),v(E,"class","button outlined thin")},m(d,u){A(d,e,u),k(e,t),A(d,o,u),A(d,r,u);for(let h=0;h<y.length;h+=1)y[h]&&y[h].m(r,null);Ve(r,n[6],!0),A(d,i,u),A(d,s,u),A(d,l,u),A(d,a,u),k(a,c),A(d,f,u),A(d,g,u);for(let h=0;h<B.length;h+=1)B[h]&&B[h].m(g,null);Ve(g,n[5],!0),A(d,p,u),A(d,D,u),A(d,P,u),A(d,E,u),k(E,_),H||(I=[ce(r,"change",n[9]),ce(g,"change",n[10]),ce(E,"click",n[8])],H=!0)},p(d,u){if(u&8){C=d[3];let h;for(h=0;h<C.length;h+=1){const b=_t(d,C,h);y[h]?y[h].p(b,u):(y[h]=bt(b),y[h].c(),y[h].m(r,null))}for(;h<y.length;h+=1)y[h].d(1);y.length=C.length}if(u&72&&Ve(r,d[6]),u&16){w=d[4];let h;for(h=0;h<w.length;h+=1){const b=pt(d,w,h);B[h]?B[h].p(b,u):(B[h]=vt(b),B[h].c(),B[h].m(g,null))}for(;h<B.length;h+=1)B[h].d(1);B.length=w.length}u&48&&Ve(g,d[5])},d(d){d&&m(e),d&&m(o),d&&m(r),Fe(y,d),d&&m(i),d&&m(s),d&&m(l),d&&m(a),d&&m(f),d&&m(g),Fe(B,d),d&&m(p),d&&m(D),d&&m(P),d&&m(E),H=!1,Qe(I)}}}function bn(n){let e,t,o,r,i;return{c(){e=O("div"),t=O("div"),o=q(),r=O("p"),i=L(n[1]),this.h()},l(s){e=R(s,"DIV",{class:!0});var l=V(e);t=R(l,"DIV",{class:!0}),V(t).forEach(m),o=G(l),r=R(l,"P",{});var a=V(r);i=z(a,n[1]),a.forEach(m),l.forEach(m),this.h()},h(){v(t,"class","spinner large margin-auto"),v(e,"class","ta-center")},m(s,l){A(s,e,l),k(e,t),k(e,o),k(e,r),k(r,i)},p(s,l){l&2&&ee(i,s[1])},d(s){s&&m(e)}}}function vn(n){let e,t,o,r,i,s,l=n[2]&&yt(n);return{c(){e=O("div"),t=O("button"),o=L("Start Webcam"),r=q(),l&&l.c(),this.h()},l(a){e=R(a,"DIV",{class:!0});var c=V(e);t=R(c,"BUTTON",{id:!0,class:!0});var f=V(t);o=z(f,"Start Webcam"),f.forEach(m),r=G(c),l&&l.l(c),c.forEach(m),this.h()},h(){v(t,"id","startWebcam"),v(t,"class","button outlined thin"),v(e,"class","ta-center")},m(a,c){A(a,e,c),k(e,t),k(t,o),k(e,r),l&&l.m(e,null),i||(s=ce(t,"click",n[7]),i=!0)},p(a,c){a[2]?l?l.p(a,c):(l=yt(a),l.c(),l.m(e,null)):l&&(l.d(1),l=null)},d(a){a&&m(e),l&&l.d(),i=!1,s()}}}function bt(n){let e,t=n[11].label+"",o,r;return{c(){e=O("option"),o=L(t),this.h()},l(i){e=R(i,"OPTION",{});var s=V(e);o=z(s,t),s.forEach(m),this.h()},h(){e.__value=r=n[11].deviceId,e.value=e.__value},m(i,s){A(i,e,s),k(e,o)},p(i,s){s&8&&t!==(t=i[11].label+"")&&ee(o,t),s&8&&r!==(r=i[11].deviceId)&&(e.__value=r,e.value=e.__value)},d(i){i&&m(e)}}}function vt(n){let e,t=n[11].label+"",o,r;return{c(){e=O("option"),o=L(t),this.h()},l(i){e=R(i,"OPTION",{});var s=V(e);o=z(s,t),s.forEach(m),this.h()},h(){e.__value=r=n[11].deviceId,e.value=e.__value},m(i,s){A(i,e,s),k(e,o)},p(i,s){s&16&&t!==(t=i[11].label+"")&&ee(o,t),s&16&&r!==(r=i[11].deviceId)&&(e.__value=r,e.value=e.__value)},d(i){i&&m(e)}}}function yt(n){var l;let e,t,o,r,i=((l=n[2])==null?void 0:l.message)+"",s;return{c(){e=O("div"),t=O("p"),o=L("Failed to start webcam: "),r=O("code"),s=L(i),this.h()},l(a){e=R(a,"DIV",{class:!0});var c=V(e);t=R(c,"P",{class:!0});var f=V(t);o=z(f,"Failed to start webcam: "),r=R(f,"CODE",{});var g=V(r);s=z(g,i),g.forEach(m),f.forEach(m),c.forEach(m),this.h()},h(){v(t,"class","svelte-1n7z142"),v(e,"class","error svelte-1n7z142")},m(a,c){A(a,e,c),k(e,t),k(t,o),k(t,r),k(r,s)},p(a,c){var f;c&4&&i!==(i=((f=a[2])==null?void 0:f.message)+"")&&ee(s,i)},d(a){a&&m(e)}}}function yn(n){let e;function t(i,s){if(i[0]==="start")return vn;if(i[0]==="busy")return bn;if(i[0]==="devicelist")return _n;if(i[0]==="success")return pn}let o=t(n),r=o&&o(n);return{c(){e=O("div"),r&&r.c(),this.h()},l(i){e=R(i,"DIV",{class:!0});var s=V(e);r&&r.l(s),s.forEach(m),this.h()},h(){v(e,"class","webcamSelector svelte-1n7z142")},m(i,s){A(i,e,s),r&&r.m(e,null)},p(i,[s]){o===(o=t(i))&&r?r.p(i,s):(r&&r.d(1),r=o&&o(i),r&&(r.c(),r.m(e,null)))},i:fe,o:fe,d(i){i&&m(e),r&&r.d()}}}function wn(n,e,t){let o="start",r="",i,s=[],l=[],a,c;async function f(){t(0,o="busy"),t(2,i=void 0),t(1,r="Detecting Devices...");try{const P=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),E=await navigator.mediaDevices.enumerateDevices();if(t(3,s=E.filter(_=>_.kind==="videoinput")),t(4,l=E.filter(_=>_.kind==="audioinput")),s.length===0){t(0,o="start"),t(2,i=new Error("No devices found"));return}if(s.length===1){Be.set(P),t(0,o="success");return}t(6,c=s[0].deviceId),t(5,a=l[0].deviceId),t(0,o="devicelist")}catch(P){t(2,i=P),t(0,o="start");return}}async function g(){t(2,i=void 0),t(0,o="busy"),t(1,r="Starting Webcam...");try{const P=await navigator.mediaDevices.getUserMedia({video:{deviceId:c},audio:{deviceId:a}});Be.set(P),t(0,o="success")}catch(P){t(2,i=P),t(0,o="devicelist")}}function p(){c=ct(this),t(6,c),t(3,s)}function D(){a=ct(this),t(5,a),t(4,l)}return[o,r,i,s,l,a,c,f,g,p,D]}class Sn extends Ee{constructor(e){super(),Te(this,e,wn,yn,De,{})}}function kn(n){let e,t,o;return t=new Sn({}),{c(){e=O("div"),ve(t.$$.fragment)},l(r){e=R(r,"DIV",{});var i=V(e);ye(t.$$.fragment,i),i.forEach(m)},m(r,i){A(r,e,i),we(t,e,null),o=!0},p:fe,i(r){o||(oe(t.$$.fragment,r),o=!0)},o(r){se(t.$$.fragment,r),o=!1},d(r){r&&m(e),Se(t)}}}function En(n){let e,t,o,r,i;return{c(){e=O("video"),t=q(),o=O("canvas"),this.h()},l(s){e=R(s,"VIDEO",{class:!0}),V(e).forEach(m),t=G(s),o=R(s,"CANVAS",{class:!0}),V(o).forEach(m),this.h()},h(){e.autoplay=!0,v(e,"class","svelte-1b7esxu"),Me(e,"flippedHorizontal",n[1]),v(o,"class","svelte-1b7esxu"),Me(o,"flippedHorizontal",n[1])},m(s,l){A(s,e,l),n[23](e),e.muted=n[0],A(s,t,l),A(s,o,l),n[25](o),r||(i=[ce(e,"play",n[7]),ce(e,"loadeddata",n[6]),ce(e,"volumechange",n[24])],r=!0)},p(s,l){l[0]&1&&(e.muted=s[0]),l[0]&2&&Me(e,"flippedHorizontal",s[1]),l[0]&2&&Me(o,"flippedHorizontal",s[1])},i:fe,o:fe,d(s){s&&m(e),n[23](null),s&&m(t),s&&m(o),n[25](null),r=!1,Qe(i)}}}function Tn(n){let e,t,o,r;const i=[En,kn],s=[];function l(a,c){return a[4]?0:1}return t=l(n),o=s[t]=i[t](n),{c(){e=O("div"),o.c(),this.h()},l(a){e=R(a,"DIV",{class:!0});var c=V(e);o.l(c),c.forEach(m),this.h()},h(){v(e,"class","wrapper svelte-1b7esxu")},m(a,c){A(a,e,c),s[t].m(e,null),n[26](e),r=!0},p(a,c){let f=t;t=l(a),t===f?s[t].p(a,c):(Ut(),se(s[f],1,1,()=>{s[f]=null}),Wt(),o=s[t],o?o.p(a,c):(o=s[t]=i[t](a),o.c()),oe(o,1),o.m(e,null))},i(a){r||(oe(o),r=!0)},o(a){se(o),r=!1},d(a){a&&m(e),s[t].d(),n[26](null)}}}const Dn=50;function Pn(n,e,t){let o;Ie(n,Be,S=>t(4,o=S));const r=-1e3,i=xe();let{poseEstimationEnabled:s=!1}=e,{drawSkeleton:l=!1}=e,{muted:a=!0}=e,{poseEstimationCheckFunction:c=()=>!0}=e,f=null,{customDrawFn:g=null}=e,p,{poseEstimationPrimedPromise:D=new Promise(S=>p=S)}=e,P=!1,E,_,H,I,C,y;const w=new Promise(S=>y=S);let{mirrorHorizontally:B=!0}=e,d=new Date().getTime(),u=-1,h=new Date().getTime(),b=-1,T=null,U=1,N=1,re=1,J=1,Q=1,M=1;function j(){E&&(t(19,U=E.videoWidth),t(20,N=E.videoHeight))}const K=()=>{_&&(M>re?(t(3,_.height=Q,_),t(3,_.width=Q*re,_)):(t(3,_.width=J,_),t(3,_.height=J/re,_)))};function x(){return t(16,f=gt),t(16,f.onmessage=S=>{if(S.data.type===je.poseEstimation){if(h=new Date().getTime(),S.data.frameId===r){p==null||p();return}b=S.data.frameId,T=S.data.estimatedPose;const he={frameId:S.data.frameId,estimatedPose:S.data.estimatedPose,srcWidth:S.data.srcWidth,srcHeight:S.data.srcHeight};i("poseEstimationResult",he)}else S.data.type===je.error||S.data.type===je.resetError?(console.error("PoseEstim Error Message",S.data.type,S.data.error),S.data.frameId===u&&(u=-1,T=null)):S.data.type==je.resetComplete&&(console.log("Pose Estimation Reset Complete"),u=-1,T=null)},f),gt.postMessage({type:Ge.reset,frameId:new Date().getTime()}),f.ready}async function le(){if(!s||!f||!I||!_)throw new Error("Pose estimation not enabled, or not yet ready.");return console.log("Priming pose estimation"),t(8,D=new Promise(S=>p=S)),f.postMessage({type:Ge.requestPoseEstimation,frameId:r,image:I.getImageData(0,0,_.width,_.height)}),D}He(async()=>{s&&x(),await on(),K();const S=new ResizeObserver(he=>{if(!H)return;const[ae,ie]=rn(H);t(21,J=ae),t(22,Q=ie)});return S.observe(H),()=>{f==null||f.terminate(),S.unobserve(H)}});function te(){!E||!o||(t(2,E.srcObject=o,E),t(17,P=!0),y&&(y(),y=void 0))}let Z=0;function $(){if(!_||!E||!o||!I)return;Z+=1;const S=E.videoWidth/E.videoHeight,he=_.width/_.height;let ae=_.width,ie=_.height,ge=0,pe=0;if(S>he?(ie=_.width/S,pe=(_.height-ie)/2):(ae=ie*S,ge=(_.width-ae)/2),I.drawImage(E,ge,pe,ae,ie),!(ge>=0&&pe>=0&&ae>0&&ie>0&&he>0&&S>0)){requestAnimationFrame($);return}const Ce=new Date().getTime(),F=Ce-h;if(s&&b==u&&F>Dn&&c()){const ne=Ce-d;u=Z,i("poseEstimationFrameSent",{frameId:Z,timestampMs:ne}),f==null||f.postMessage({type:Ge.requestPoseEstimation,frameId:Z,timestampMs:ne,image:I.getImageData(ge,pe,ae,ie)})}if(g==null||g(I,T),!l){requestAnimationFrame($);return}I.save(),T&&T.length===Je.length&&(C==null||C.drawConnectors(T,Qt.POSE_CONNECTIONS),C==null||C.drawLandmarks(T,{radius:ne=>Ye.lerp(ne.from.z,-.15,.1,5,1)})),I.restore(),requestAnimationFrame($)}He(()=>(te(),{}));function X(S){de[S?"unshift":"push"](()=>{E=S,t(2,E)})}function me(){a=this.muted,t(0,a)}function Ne(S){de[S?"unshift":"push"](()=>{_=S,t(3,_)})}function Le(S){de[S?"unshift":"push"](()=>{H=S,t(5,H)})}return n.$$set=S=>{"poseEstimationEnabled"in S&&t(9,s=S.poseEstimationEnabled),"drawSkeleton"in S&&t(10,l=S.drawSkeleton),"muted"in S&&t(0,a=S.muted),"poseEstimationCheckFunction"in S&&t(11,c=S.poseEstimationCheckFunction),"customDrawFn"in S&&t(12,g=S.customDrawFn),"poseEstimationPrimedPromise"in S&&t(8,D=S.poseEstimationPrimedPromise),"mirrorHorizontally"in S&&t(1,B=S.mirrorHorizontally)},n.$$.update=()=>{n.$$.dirty[0]&1572864&&(re=U/N),n.$$.dirty[0]&6291456&&(M=J/Q),n.$$.dirty[0]&66048&&s&&!f&&x(),n.$$.dirty[0]&20&&o&&E&&te(),n.$$.dirty[0]&7864320&&U&&N&&J&&Q&&K(),n.$$.dirty[0]&393228&&P&&E&&_&&(t(18,I=_.getContext("2d",{willReadFrequently:!0})),C=new Ye(I),$())},[a,B,E,_,o,H,j,K,D,s,l,c,g,w,x,le,f,P,I,U,N,J,Q,X,me,Ne,Le]}class In extends Ee{constructor(e){super(),Te(this,e,Pn,Tn,De,{poseEstimationEnabled:9,drawSkeleton:10,muted:0,poseEstimationCheckFunction:11,customDrawFn:12,poseEstimationPrimedPromise:8,webcamStartedPromise:13,mirrorHorizontally:1,setupPoseEstimation:14,primePoseEstimation:15},null,[-1,-1])}get webcamStartedPromise(){return this.$$.ctx[13]}get setupPoseEstimation(){return this.$$.ctx[14]}get primePoseEstimation(){return this.$$.ctx[15]}}function Fn({params:n}){const e=n.danceTreeId,[t,o]=xt(e);if(!t)throw lt(404,"Dance Not found");if(!o)throw lt(404,"Dance Tree Not found");const r=$t(o,n.practiceNodeId);return{dance:t,danceTree:o,danceTreeNode:r}}const Cn=!1,ko=Object.freeze(Object.defineProperty({__proto__:null,load:Fn,prerender:Cn},Symbol.toStringTag,{value:"Module"}));function Vn(n,e,t){return{startTime:t.start_time,endTime:t.end_time,activityTypes:["drill"],playbackSpeed:.5}}let Ae;const Mn=new Uint8Array(16);function On(){if(!Ae&&(Ae=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Ae))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ae(Mn)}const Y=[];for(let n=0;n<256;++n)Y.push((n+256).toString(16).slice(1));function Rn(n,e=0){return(Y[n[e+0]]+Y[n[e+1]]+Y[n[e+2]]+Y[n[e+3]]+"-"+Y[n[e+4]]+Y[n[e+5]]+"-"+Y[n[e+6]]+Y[n[e+7]]+"-"+Y[n[e+8]]+Y[n[e+9]]+"-"+Y[n[e+10]]+Y[n[e+11]]+Y[n[e+12]]+Y[n[e+13]]+Y[n[e+14]]+Y[n[e+15]]).toLowerCase()}const jn=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),wt={randomUUID:jn};function St(n,e,t){if(wt.randomUUID&&!e&&!n)return wt.randomUUID();n=n||{};const o=n.random||(n.rng||On)();if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,e){t=t||0;for(let r=0;r<16;++r)e[t+r]=o[r];return e}return Rn(o)}const An={head:0,torso:1,leftarm:2,rightarm:3,leftleg:4,rightleg:5},kt=Object.freeze(["Nice Job!","Great Moves!","You're Killing It!","Awesome Dancing!","Keep It Up!","Incredible Rhythm!","Impressive Dancing!","Amazing Performance!","You've Got the Groove!","You're a Dancing Machine!","Phenomenal Footwork!","You're a Star!","Excellent Execution!","You're on Fire!","Superb Dancing!","You're a Pro!","Outstanding Performance!"]);function Hn(){return kt[Math.floor(Math.random()*kt.length)]}const Et=Object.freeze(["Don't Give Up!","Keep Pushing!","You've Got This!","Stay Strong!","Keep Going!","Believe In Yourself!","Stay Focused!","Never Give Up!","You Can Do It!","Stay Motivated!","Keep Moving Forward!","Stay Resilient!","Stay Positive!","Stay Determined!","Stay Committed!","Stay Persistent!","Stay Confident!","Stay Inspired!","Stay Driven!","Stay Tenacious!"]);function Bn(){return Et[Math.floor(Math.random()*Et.length)]}let qt=1;an.subscribe(n=>{qt=n});function Tt(n){const e=ue(be(n,W.leftShoulder,W.leftHip)),t=ue(be(n,W.rightShoulder,W.rightHip)),o=ue(be(n,W.leftShoulder,W.rightShoulder));return .25*e+.25*t+.5*o}const ke=Object.freeze([[W.leftShoulder,W.rightShoulder],[W.leftShoulder,W.leftHip],[W.leftHip,W.rightHip],[W.rightHip,W.rightShoulder],[W.leftShoulder,W.leftElbow],[W.leftElbow,W.leftWrist],[W.rightShoulder,W.rightElbow],[W.rightElbow,W.rightWrist]]),Ze=ke.map(n=>{const[e,t]=n,[o,r]=[Je[e],Je[t]];return`${o} -> ${r}`}),Dt=50,Pt=100,Nn=new Map(Ze.map((n,e)=>[n,e]));function ue(n){return Math.pow(Math.pow(n[0],2)+Math.pow(n[1],2),.5)}function Ln(n,e){return Math.acos((n[0]*e[0]+n[1]*e[1])/(ue(n)*ue(e)))}function zn(n){return n.reduce((e,t)=>e+t,0)}function _e(n){return zn(n)/n.length}function be(n,e,t){const{x:o,y:r}=n[e],{x:i,y:s}=n[t];return[i-o,s-r]}function It(n,e,t){const[o,r]=be(n,e,t),i=ue([o,r]);return[o/i,r/i]}function Un(n,e){const t=ke.map((o,r)=>{const[i,s]=o,[l,a]=be(n,i,s),[c,f]=be(e,i,s),g=Tt(n),p=Tt(e),[D,P]=[ue([l,a]),ue([c,f])],E=P*g/p,_=Math.abs(D-E)/Math.max(D,E),I=Ln([l,a],[c,f])/Math.PI,C=Ke(D,Dt,Pt,0,1),y=Ke(P,Dt,Pt,0,1),w=Math.min(C,y),B=w*I+(1-w)*_;return{magnitude:_,angle:I,pAngle:w,score:B}});return{score:_e(t.map(o=>o.score)),infoByVetor:t}}function Wn(n,e){let t=0;const o=ke.map(g=>{const[p,D]=g,[P,E]=It(n,p,D),[_,H]=It(e,p,D),[I,C]=[P-_,E-H];return ue([I,C])||0});t=_e(o);const r=2,i=0,s=5,l=0;function a(g){return Ke(g,i,r,s,l)}const c=a(t),f=o.map(a);return[c,f]}class qn{constructor(){qe(this,"tracks",new Map)}recordEvaluationFrame(e,t,o,r){var a;const i=Object.keys(r);let s;this.tracks.has(e)?s=this.tracks.get(e):(s={creationDate:new Date,frameTimes:[],recordTimesMs:[],userPoses:[],evaluation:i.reduce((c,f)=>(c[f]=[],c),{})},this.tracks.set(e,s));const l=((a=this.tracks.get(e))==null?void 0:a.frameTimes.slice(-1)[0])??-1/0;if(t<l)throw new Error("Frame time must be increasing");s.frameTimes.push(t),s.recordTimesMs.push(new Date().getTime()),s.userPoses.push(o);for(const c of i)s.evaluation[c].push(r[c])}}const Gn=new Map([[0,"torso"],[1,"torso"],[2,"torso"],[3,"torso"],[4,"leftarm"],[5,"leftarm"],[6,"rightarm"],[7,"rightarm"]]);class Yn{constructor(e){qe(this,"recorder",new qn);this.referenceData=e}evaluateFrame(e,t,o){const r=this.referenceData.getReferencePoseAtTime(t);if(!r)return null;const[i,s]=Wn(r,o),l=Un(r,o),a={qijiaOverallScore:i,qijiaByVectorScores:s,julienScore:l.score,julienByVectorInfo:l.infoByVetor};return this.recorder.recordEvaluationFrame(e,t,o,a),a}getPerformanceSummary(e){const t=this.recorder.tracks.get(e);if(!t)return null;const o=ke.map((P,E)=>{const _=Ze[E],H=t.evaluation.qijiaByVectorScores.map(C=>C[E]),I=_e(H);return[_,I]}),r=_e(t.evaluation.qijiaOverallScore),i=new Map(o),s=_e(t.evaluation.julienScore),l=ke.map((P,E)=>{const _=Ze[E],H=t.evaluation.julienByVectorInfo.map(C=>C[E].score),I=_e(H);return[_,I]}),a=new Map(l),c=t.frameTimes.length,f=(t.recordTimesMs[c-1]-t.recordTimesMs[0])/1e3,g=t.frameTimes[c-1]-t.frameTimes[0],p=c/g,D=c/f;return{frameCount:c,danceTimeDurationSecs:g,realtimeDurationSecs:f,danceTimeFps:p,realTimeFps:D,qijiaOverallScore:r,qijiaByVectorScores:i,julienOverallScore:s,julienByVectorScores:a}}generateTerminalFeedback(e){if(!e)return{headline:"Try Again?",subHeadline:"We don't have any feedback for you.",suggestedAction:"repeat"};const{qijiaOverallScore:t,qijiaByVectorScores:o}=e;let r,i,s,l,a;const[c,f]=[...o.keys()].map(g=>{const p=Nn.get(g);if(p===void 0)throw new Error("Unexpected vector name: "+g);const D=o.get(g);if(D===void 0)throw new Error("Unable to retrieve score for "+g);return[p,D]}).reduce(([g,p],[D,P])=>P<p?[D,P]:[g,p],[-1,1/0]);if(t>qt)r=Hn(),i="You did great on that trial! Would you like to move on now?",s="next",a=[...Object.keys(An)];else{r=Bn(),i="Want to try again?",s="repeat";const g=Gn.get(c);if(!g)throw new Error("Unexpected vector index: "+c);l=[g]}return{headline:r,subHeadline:i,score:{achieved:t,maximumPossible:5},suggestedAction:s,incorrectBodyPartsToHighlight:l,correctBodyPartsToHighlight:a,debugJson:e}}}const Jn=ke.map(([n,e])=>({start:n,end:e}));let Gt=0;cn.subscribe(n=>{Gt=n});let Yt=0;un.subscribe(n=>{Yt=n});function Kn(n,e){const t=e==null?void 0:e.qijiaByVectorScores[n.index??-1];return t===void 0?"white":t>=Gt?"green":t>=Yt?"yellow":"red"}function Zn(n,e,t,o=!1){if(!e)return;o&&(e=mn(e)),new Ye(n).drawConnectors(e,Jn,{color:i=>Kn(i,t),lineWidth:4})}const Xn=""+new URL("../assets/metronome.208d4270.mp3",import.meta.url).href;var Xe={};(function(n){(function(e,t){t(n)})(en,function(e){var t,o,r,i=window,s=document,l="appendChild",a="test",c=";text-shadow:",f="opacity:.",g=" 0px 0px ",p="3px 0px 5",D=")",P=function(E){for(o=s.getElementsByClassName(E||"microlight"),t=0;r=o[t++];)for(var _,H,I,C,y,w=r.textContent,B=0,d=w[0],u=1,h=r.innerHTML="",b=0,T=/(\d*\, \d*\, \d*)(, ([.\d]*))?/g.exec(i.getComputedStyle(r).color),U="px rgba("+T[1]+",",N=T[3]||1;H=_,_=7>b&&_=="\\"?1:u;){if(u=d,d=w[++B],C=h.length>1,!u||b>8&&u==`
`||[/\S/[a](u),1,1,!/[$\w]/[a](u),(_=="/"||_==`
`)&&C,_=='"'&&C,_=="'"&&C,w[B-4]+H+_=="-->",H+_=="*/"][b])for(h&&(r[l](y=s.createElement("span")).setAttribute("style",["",c+g+9+U+.7*N+"),"+g+2+U+.4*N+D,f+6+c+g+7+U+N/4+"),"+g+3+U+N/4+D,f+7+c+p+U+N/5+"),-"+p+U+N/5+D,"font-style:italic;"+f+5+c+p+U+N/4+"),-"+p+U+N/4+D][b?3>b?2:b>6?4:b>3?3:+/^(a(bstract|lias|nd|rguments|rray|s(m|sert)?|uto)|b(ase|egin|ool(ean)?|reak|yte)|c(ase|atch|har|hecked|lass|lone|ompl|onst|ontinue)|de(bugger|cimal|clare|f(ault|er)?|init|l(egate|ete)?)|do|double|e(cho|ls?if|lse(if)?|nd|nsure|num|vent|x(cept|ec|p(licit|ort)|te(nds|nsion|rn)))|f(allthrough|alse|inal(ly)?|ixed|loat|or(each)?|riend|rom|unc(tion)?)|global|goto|guard|i(f|mp(lements|licit|ort)|n(it|clude(_once)?|line|out|stanceof|t(erface|ernal)?)?|s)|l(ambda|et|ock|ong)|m(icrolight|odule|utable)|NaN|n(amespace|ative|ext|ew|il|ot|ull)|o(bject|perator|r|ut|verride)|p(ackage|arams|rivate|rotected|rotocol|ublic)|r(aise|e(adonly|do|f|gister|peat|quire(_once)?|scue|strict|try|turn))|s(byte|ealed|elf|hort|igned|izeof|tatic|tring|truct|ubscript|uper|ynchronized|witch)|t(emplate|hen|his|hrows?|ransient|rue|ry|ype(alias|def|id|name|of))|u(n(checked|def(ined)?|ion|less|signed|til)|se|sing)|v(ar|irtual|oid|olatile)|w(char_t|hen|here|hile|ith)|xor|yield)$/[a](h):0]),y[l](s.createTextNode(h))),I=b&&7>b?b:I,h="",b=11;![1,/[\/{}[(\-+*=<>:;|\\.,?!&@~]/[a](u),/[\])]/[a](u),/[$\w]/[a](u),u=="/"&&2>I&&_!="<",u=='"',u=="'",u+d+w[B+1]+w[B+2]=="<!--",u+d=="/*",u+d=="//",u=="#"][--b];);h+=u}};e.reset=P,s.readyState=="complete"?P():i.addEventListener("load",function(){P()},0)})})(Xe);function Ft(n,e,t){const o=n.slice();return o[7]=e[t],o[9]=t,o}function Ct(n,e,t){const o=n.slice();return o[10]=e[t],o[9]=t,o}function Vt(n){let e;return{c(){e=$e("path"),this.h()},l(t){e=et(t,"path",{d:!0,fill:!0,stroke:!0,"stroke-width":!0}),V(e).forEach(m),this.h()},h(){v(e,"d",n[5][n[10]]),v(e,"fill",n[1]),v(e,"stroke",n[2]),v(e,"stroke-width","0.5")},m(t,o){A(t,e,o)},p(t,o){o&2&&v(e,"fill",t[1]),o&4&&v(e,"stroke",t[2])},d(t){t&&m(e)}}}function Mt(n){let e,t,o,r;return{c(){e=$e("path"),this.h()},l(i){e=et(i,"path",{d:!0,fill:!0,stroke:!0,"stroke-width":!0}),V(e).forEach(m),this.h()},h(){v(e,"d",t=n[5][n[7].bodyPart]),v(e,"fill",o=n[7].fillColor??n[3]),v(e,"stroke",r=n[7].outlineColor??n[4]),v(e,"stroke-width","0.5")},m(i,s){A(i,e,s)},p(i,s){s&1&&t!==(t=i[5][i[7].bodyPart])&&v(e,"d",t),s&9&&o!==(o=i[7].fillColor??i[3])&&v(e,"fill",o),s&17&&r!==(r=i[7].outlineColor??i[4])&&v(e,"stroke",r)},d(i){i&&m(e)}}}function Qn(n){let e,t,o=n[6],r=[];for(let l=0;l<o.length;l+=1)r[l]=Vt(Ct(n,o,l));let i=n[0],s=[];for(let l=0;l<i.length;l+=1)s[l]=Mt(Ft(n,i,l));return{c(){e=$e("svg");for(let l=0;l<r.length;l+=1)r[l].c();t=dt();for(let l=0;l<s.length;l+=1)s[l].c();this.h()},l(l){e=et(l,"svg",{xmlns:!0,viewBox:!0,preserveAspectRatio:!0,class:!0});var a=V(e);for(let c=0;c<r.length;c+=1)r[c].l(a);t=dt();for(let c=0;c<s.length;c+=1)s[c].l(a);a.forEach(m),this.h()},h(){v(e,"xmlns","http://www.w3.org/2000/svg"),v(e,"viewBox","0 -1 14 55"),v(e,"preserveAspectRatio","xMinYMin slice"),v(e,"class","svelte-1dgy757")},m(l,a){A(l,e,a);for(let c=0;c<r.length;c+=1)r[c]&&r[c].m(e,null);k(e,t);for(let c=0;c<s.length;c+=1)s[c]&&s[c].m(e,null)},p(l,[a]){if(a&102){o=l[6];let c;for(c=0;c<o.length;c+=1){const f=Ct(l,o,c);r[c]?r[c].p(f,a):(r[c]=Vt(f),r[c].c(),r[c].m(e,t))}for(;c<r.length;c+=1)r[c].d(1);r.length=o.length}if(a&57){i=l[0];let c;for(c=0;c<i.length;c+=1){const f=Ft(l,i,c);s[c]?s[c].p(f,a):(s[c]=Mt(f),s[c].c(),s[c].m(e,null))}for(;c<s.length;c+=1)s[c].d(1);s.length=i.length}},i:fe,o:fe,d(l){l&&m(e),Fe(r,l),Fe(s,l)}}}function xn(n,e,t){let{highlights:o=[]}=e,{stdFillColor:r="#000"}=e,{stdOutlineColor:i="#AAA"}=e,{highlightFillColor:s="#000"}=e,{highlightOutlineColor:l="#77F"}=e;const a={head:"M 7 0 C 9.5 0 10 2 10 4 S 8.5 8 7 8 S 4 6 4 4 S 4.5 0 7 0 Z",torso:"M 7 10 C 10 10 12 10 12 11 S 10.5 18 10.5 21 S 11 26 11 27 S 9 28 7 28 S 3 28 3 27 S 3.5 24 3.5 21 S 2 12 2 11 S 4 10 7 10 Z",leftleg:"M 8 29 L 8.5 40 L 8.25 50 C 8.25 51 8.35 52 8.5 53.5 C 9.5 53.5 10.75 53.5 10.5 53 L 9.5 51 L 10.5 41 L 10.5 40 L 11 29 C 11 28.25 8 28.25 8 29 Z",rightleg:"M 6 29 L 5.5 40 L 5.75 50 C 5.75 51 5.65 52 5.5 53.5 C 4.5 53.5 3.25 53.5 3.5 53 L 4.5 51 L 3.5 41 L 3.5 40 L 3 29 C 3 28.25 6 28.25 6 29 Z",leftarm:"M 12.25 11 C 12.75 11.5 12.75 12 13 13 C 13.5 16 13.75 18 13.75 20 S 13 25 13 26 S 13.2 27 13.2 28 S 12 29 12 28.5 S 11.75 27 12 26 C 12.25 25 12 22 12.5 20 C 12.1 14 11.5 15 12.2 11 Z",rightarm:"M 1.75 11 C 1.25 11.5 1.25 12 1 13 C 0.5 16 0.25 18 0.25 20 S 1 25 1 26 S 0.8 27 0.8 28 S 2 29 2 28.5 S 2.25 27 2 26 C 1.75 25 2 22 1.5 20 C 1.9 14 2.5 15 1.8 11 Z"},c=Object.keys(a);return n.$$set=f=>{"highlights"in f&&t(0,o=f.highlights),"stdFillColor"in f&&t(1,r=f.stdFillColor),"stdOutlineColor"in f&&t(2,i=f.stdOutlineColor),"highlightFillColor"in f&&t(3,s=f.highlightFillColor),"highlightOutlineColor"in f&&t(4,l=f.highlightOutlineColor)},[o,r,i,s,l,a,c]}class $n extends Ee{constructor(e){super(),Te(this,e,xn,Qn,De,{highlights:0,stdFillColor:1,stdOutlineColor:2,highlightFillColor:3,highlightOutlineColor:4})}}function Ot(n,e){return e instanceof Map?Object.fromEntries(e):e!=null&&e.toFixed?parseFloat(e.toFixed(2)):e}function Rt(n,e,t){const o=n.slice();return o[9]=e[t],o}function jt(n){let e,t,o,r=n[0].score.achieved.toFixed(2)+"",i,s,l=n[0].score.maximumPossible.toFixed(2)+"",a;return{c(){e=O("p"),t=O("code"),o=L("Score: "),i=L(r),s=L(" / "),a=L(l),this.h()},l(c){e=R(c,"P",{class:!0});var f=V(e);t=R(f,"CODE",{});var g=V(t);o=z(g,"Score: "),i=z(g,r),s=z(g," / "),a=z(g,l),g.forEach(m),f.forEach(m),this.h()},h(){v(e,"class","svelte-njh6n0")},m(c,f){A(c,e,f),k(e,t),k(t,o),k(t,i),k(t,s),k(t,a)},p(c,f){f&1&&r!==(r=c[0].score.achieved.toFixed(2)+"")&&ee(i,r),f&1&&l!==(l=c[0].score.maximumPossible.toFixed(2)+"")&&ee(a,l)},d(c){c&&m(e)}}}function At(n){let e,t,o=n[9]+"",r,i;return{c(){e=O("p"),t=L("Try focusing on your "),r=L(o),i=L(" next time."),this.h()},l(s){e=R(s,"P",{class:!0});var l=V(e);t=z(l,"Try focusing on your "),r=z(l,o),i=z(l," next time."),l.forEach(m),this.h()},h(){v(e,"class","svelte-njh6n0")},m(s,l){A(s,e,l),k(e,t),k(e,r),k(e,i)},p(s,l){l&1&&o!==(o=s[9]+"")&&ee(r,o)},d(s){s&&m(e)}}}function Ht(n){let e,t=JSON.stringify(n[0].debugJson,Ot,2)+"",o;return{c(){e=O("pre"),o=L(t),this.h()},l(r){e=R(r,"PRE",{class:!0});var i=V(e);o=z(i,t),i.forEach(m),this.h()},h(){v(e,"class","microlight svelte-njh6n0")},m(r,i){A(r,e,i),k(e,o)},p(r,i){i&1&&t!==(t=JSON.stringify(r[0].debugJson,Ot,2)+"")&&ee(o,t)},d(r){r&&m(e)}}}function eo(n){var U,N,re,J,Q;let e,t,o=((U=n[0])==null?void 0:U.headline)+"",r,i,s,l=((N=n[0])==null?void 0:N.subHeadline)+"",a,c,f,g,p,D,P,E,_,H,I,C,y,w,B,d,u=((re=n[0])==null?void 0:re.score)&&jt(n),h=((J=n[0])==null?void 0:J.incorrectBodyPartsToHighlight)??[],b=[];for(let M=0;M<h.length;M+=1)b[M]=At(Rt(n,h,M));D=new $n({props:{highlights:n[4]}});let T=n[1]&&((Q=n[0])==null?void 0:Q.debugJson)&&Ht(n);return{c(){e=O("div"),t=O("h2"),r=L(o),i=q(),s=O("p"),a=L(l),c=q(),u&&u.c(),f=q();for(let M=0;M<b.length;M+=1)b[M].c();g=q(),p=O("div"),ve(D.$$.fragment),P=q(),T&&T.c(),E=q(),_=O("button"),H=L(n[2]),I=q(),C=O("button"),y=L(n[3]),this.h()},l(M){e=R(M,"DIV",{class:!0});var j=V(e);t=R(j,"H2",{class:!0});var K=V(t);r=z(K,o),K.forEach(m),i=G(j),s=R(j,"P",{class:!0});var x=V(s);a=z(x,l),x.forEach(m),c=G(j),u&&u.l(j),f=G(j);for(let $=0;$<b.length;$+=1)b[$].l(j);g=G(j),p=R(j,"DIV",{class:!0});var le=V(p);ye(D.$$.fragment,le),le.forEach(m),P=G(j),T&&T.l(j),E=G(j),_=R(j,"BUTTON",{class:!0});var te=V(_);H=z(te,n[2]),te.forEach(m),I=G(j),C=R(j,"BUTTON",{class:!0});var Z=V(C);y=z(Z,n[3]),Z.forEach(m),j.forEach(m),this.h()},h(){v(t,"class","svelte-njh6n0"),v(s,"class","sub-headline svelte-njh6n0"),v(p,"class","skeleton svelte-njh6n0"),v(_,"class","outlined"),v(C,"class","outlined thin"),v(e,"class","feedbackForm svelte-njh6n0")},m(M,j){A(M,e,j),k(e,t),k(t,r),k(e,i),k(e,s),k(s,a),k(e,c),u&&u.m(e,null),k(e,f);for(let K=0;K<b.length;K+=1)b[K]&&b[K].m(e,null);k(e,g),k(e,p),we(D,p,null),k(e,P),T&&T.m(e,null),k(e,E),k(e,_),k(_,H),k(e,I),k(e,C),k(C,y),w=!0,B||(d=[ce(_,"click",n[5]),ce(C,"click",n[6])],B=!0)},p(M,[j]){var x,le,te,Z,$;if((!w||j&1)&&o!==(o=((x=M[0])==null?void 0:x.headline)+"")&&ee(r,o),(!w||j&1)&&l!==(l=((le=M[0])==null?void 0:le.subHeadline)+"")&&ee(a,l),(te=M[0])!=null&&te.score?u?u.p(M,j):(u=jt(M),u.c(),u.m(e,f)):u&&(u.d(1),u=null),j&1){h=((Z=M[0])==null?void 0:Z.incorrectBodyPartsToHighlight)??[];let X;for(X=0;X<h.length;X+=1){const me=Rt(M,h,X);b[X]?b[X].p(me,j):(b[X]=At(me),b[X].c(),b[X].m(e,g))}for(;X<b.length;X+=1)b[X].d(1);b.length=h.length}const K={};j&16&&(K.highlights=M[4]),D.$set(K),M[1]&&(($=M[0])!=null&&$.debugJson)?T?T.p(M,j):(T=Ht(M),T.c(),T.m(e,E)):T&&(T.d(1),T=null),(!w||j&4)&&ee(H,M[2]),(!w||j&8)&&ee(y,M[3])},i(M){w||(oe(D.$$.fragment,M),w=!0)},o(M){se(D.$$.fragment,M),w=!1},d(M){M&&m(e),u&&u.d(),Fe(b,M),Se(D),T&&T.d(),B=!1,Qe(d)}}}function to(n,e,t){let o;Ie(n,dn,p=>t(1,o=p));const r=xe();let{feedback:i=null}=e,s=!1,l="",a="";function c(){r(s?"repeat-clicked":"continue-clicked")}function f(){r(s?"continue-clicked":"repeat-clicked")}let g=[];return He(()=>{Xe.reset("microlight")}),n.$$set=p=>{"feedback"in p&&t(0,i=p.feedback)},n.$$.update=()=>{n.$$.dirty&1&&t(7,s=(i==null?void 0:i.suggestedAction)==="repeat"),n.$$.dirty&128&&t(2,l=s?"Do Again ðŸ”":"Continue âž¡ï¸"),n.$$.dirty&128&&t(3,a=s?"Continue âž¡ï¸":"Do Again ðŸ”"),n.$$.dirty&1&&t(4,g=[...((i==null?void 0:i.incorrectBodyPartsToHighlight)??[]).map(p=>({bodyPart:p,outlineColor:"#F00"})),...((i==null?void 0:i.correctBodyPartsToHighlight)??[]).map(p=>({bodyPart:p,outlineColor:"#0F0"}))]),n.$$.dirty&3&&(i==null||i.debugJson,Xe.reset("microlight"))},[i,o,l,a,g,c,f,s]}class no extends Ee{constructor(e){super(),Te(this,e,to,eo,De,{feedback:0})}}function oo(n){let e,t;return{c(){e=O("source"),this.h()},l(o){e=R(o,"SOURCE",{src:!0,type:!0}),this.h()},h(){ht(e.src,t=n[9])||v(e,"src",t),v(e,"type","video/mp4")},m(o,r){A(o,e,r)},p(o,r){r[0]&512&&!ht(e.src,t=o[9])&&v(e,"src",t)},d(o){o&&m(e)}}}function Bt(n){let e,t,o;return{c(){e=O("div"),t=O("span"),o=L(n[14]),this.h()},l(r){e=R(r,"DIV",{class:!0});var i=V(e);t=R(i,"SPAN",{class:!0});var s=V(t);o=z(s,n[14]),s.forEach(m),i.forEach(m),this.h()},h(){v(t,"class","count svelte-11jy3qp"),v(e,"class","countdown svelte-11jy3qp")},m(r,i){A(r,e,i),k(e,t),k(t,o)},p(r,i){i[0]&16384&&ee(o,r[14])},d(r){r&&m(e)}}}function Nt(n){let e,t,o;return t=new no({props:{feedback:n[13]}}),t.$on("repeat-clicked",n[2]),t.$on("continue-clicked",n[36]),{c(){e=O("div"),ve(t.$$.fragment),this.h()},l(r){e=R(r,"DIV",{class:!0});var i=V(e);ye(t.$$.fragment,i),i.forEach(m),this.h()},h(){v(e,"class","svelte-11jy3qp")},m(r,i){A(r,e,i),we(t,e,null),o=!0},p(r,i){const s={};i[0]&8192&&(s.feedback=r[13]),t.$set(s)},i(r){o||(oe(t.$$.fragment,r),o=!0)},o(r){se(t.$$.fragment,r),o=!1},d(r){r&&m(e),Se(t)}}}function Lt(n){let e,t,o;return{c(){e=O("div"),t=O("div"),o=L("Loading..."),this.h()},l(r){e=R(r,"DIV",{class:!0});var i=V(e);t=R(i,"DIV",{class:!0});var s=V(t);o=z(s,"Loading..."),s.forEach(m),i.forEach(m),this.h()},h(){v(t,"class","label svelte-11jy3qp"),v(e,"class","loading outlined thick svelte-11jy3qp")},m(r,i){A(r,e,i),k(e,t),k(t,o)},d(r){r&&m(e)}}}function ro(n){let e,t,o,r,i,s,l,a,c,f,g,p,D,P;function E(u){n[32](u)}function _(u){n[33](u)}function H(u){n[34](u)}function I(u){n[35](u)}let C={flipHorizontal:n[1],fitToFlexbox:io,poseData:n[11],drawSkeleton:lo,$$slots:{default:[oo]},$$scope:{ctx:n}};n[4]!==void 0&&(C.currentTime=n[4]),n[8]!==void 0&&(C.playbackRate=n[8]),n[6]!==void 0&&(C.paused=n[6]),n[5]!==void 0&&(C.duration=n[5]),o=new sn({props:C}),de.push(()=>Oe(o,"currentTime",E)),de.push(()=>Oe(o,"playbackRate",_)),de.push(()=>Oe(o,"paused",H)),de.push(()=>Oe(o,"duration",I));let y=n[14]>=0&&Bt(n),w=n[3]==="feedback"&&Nt(n),B={poseEstimationEnabled:n[10],drawSkeleton:!1,poseEstimationCheckFunction:n[17],customDrawFn:n[37]};p=new In({props:B}),n[38](p),p.$on("poseEstimationFrameSent",n[16]),p.$on("poseEstimationResult",n[18]);let d=n[3]==="waitStart"&&Lt();return{c(){e=O("section"),t=O("div"),ve(o.$$.fragment),a=q(),y&&y.c(),c=q(),w&&w.c(),f=q(),g=O("div"),ve(p.$$.fragment),D=q(),d&&d.c(),this.h()},l(u){e=R(u,"SECTION",{class:!0});var h=V(e);t=R(h,"DIV",{class:!0});var b=V(t);ye(o.$$.fragment,b),a=G(b),y&&y.l(b),b.forEach(m),c=G(h),w&&w.l(h),f=G(h),g=R(h,"DIV",{class:!0});var T=V(g);ye(p.$$.fragment,T),D=G(T),d&&d.l(T),T.forEach(m),h.forEach(m),this.h()},h(){v(t,"class","svelte-11jy3qp"),v(g,"class","svelte-11jy3qp"),ft(g,"display",n[3]==="feedback"?"none":"flex"),v(e,"class","practicePage svelte-11jy3qp")},m(u,h){A(u,e,h),k(e,t),we(o,t,null),k(t,a),y&&y.m(t,null),k(e,c),w&&w.m(e,null),k(e,f),k(e,g),we(p,g,null),k(g,D),d&&d.m(g,null),P=!0},p(u,h){const b={};h[0]&2&&(b.flipHorizontal=u[1]),h[0]&2048&&(b.poseData=u[11]),h[0]&512|h[1]&524288&&(b.$$scope={dirty:h,ctx:u}),!r&&h[0]&16&&(r=!0,b.currentTime=u[4],Re(()=>r=!1)),!i&&h[0]&256&&(i=!0,b.playbackRate=u[8],Re(()=>i=!1)),!s&&h[0]&64&&(s=!0,b.paused=u[6],Re(()=>s=!1)),!l&&h[0]&32&&(l=!0,b.duration=u[5],Re(()=>l=!1)),o.$set(b),u[14]>=0?y?y.p(u,h):(y=Bt(u),y.c(),y.m(t,null)):y&&(y.d(1),y=null),u[3]==="feedback"?w?(w.p(u,h),h[0]&8&&oe(w,1)):(w=Nt(u),w.c(),oe(w,1),w.m(e,f)):w&&(Ut(),se(w,1,1,()=>{w=null}),Wt());const T={};h[0]&1024&&(T.poseEstimationEnabled=u[10]),h[0]&4097&&(T.customDrawFn=u[37]),p.$set(T),u[3]==="waitStart"?d||(d=Lt(),d.c(),d.m(g,null)):d&&(d.d(1),d=null),h[0]&8&&ft(g,"display",u[3]==="feedback"?"none":"flex")},i(u){P||(oe(o.$$.fragment,u),oe(w),oe(p.$$.fragment,u),P=!0)},o(u){se(o.$$.fragment,u),se(w),se(p.$$.fragment,u),P=!1},d(u){u&&m(e),Se(o),y&&y.d(),w&&w.d(),n[38](null),Se(p),d&&d.d()}}}const Jt="waitWebcam";let io=!0;const so=10;let lo=!1;async function Pe(n){return new Promise(e=>{setTimeout(e,(n??1)*1e3)})}function ao(n,e,t){let o,r,i;Ie(n,fn,F=>t(43,o=F)),Ie(n,Be,F=>t(30,r=F)),Ie(n,hn,F=>t(31,i=F));let{mirrorForEvaluation:s=!0}=e,{dance:l}=e,{practiceActivity:a}=e,{pageActive:c=!1}=e,{flipVideo:f=!1}=e;const g=xe();let p=Jt,D=0,P="watch",E=1,_=new Audio(Xn),H,I=0,C=1,y=0,w=!0,B="",d=!1,u=null,h=null,b=null,T=null,U=St(),N=null,re=null,J=-1,Q=!1,M=(a==null?void 0:a.endTime)??0,j=null;function K(){t(29,j=null),t(28,M=(a==null?void 0:a.endTime)??y),t(6,w=!1),t(3,p="playing")}function x(){_.currentTime=0,_.play()}async function le(){Q||(t(6,w=!0),t(4,I=(a==null?void 0:a.startTime)??0),t(25,U=St()),d&&(console.log("Triggering pose estimation priming"),await H.primePoseEstimation()),t(3,p="countdown"),t(27,Q=!0),await Pe(E),t(14,J=5),x(),await Pe(E),t(14,J=6),x(),await Pe(E),t(14,J=7),x(),await Pe(E),t(14,J=8),x(),await Pe(E),t(3,p="playing"),t(14,J=-1),t(6,w=!1),t(27,Q=!1))}async function te(){j!==null&&clearTimeout(j),t(22,D=0),t(3,p="waitWebcam"),t(12,b=null),t(6,w=!0),t(4,I=(a==null?void 0:a.startTime)??0);const F=((a==null?void 0:a.endTime)??y)-I;t(28,M=o?I+F/2:(a==null?void 0:a.endTime)??y),t(11,h=await nn(l)),await H.webcamStartedPromise,t(3,p="waitStart"),t(24,T=new Yn(h)),await u,le()}let Z=new Map,$=-1,X=new Date;const me=1e3/so;function Ne(F){Z.set(F.detail.frameId,I),$=I}function Le(){return!($===I&&X.getTime()>Date.now()-me)}function S(F){var rt,it,st;if(p!=="playing"&&p!=="paused")return;if(!h){console.log("No dance pose information",F);return}const ne=F.detail.frameId;if(!Z.has(ne)){console.log(`No matching correspondance for ${ne}`,F,"current correspondances: ",Z);return}const Kt=Z.get(ne);Z.delete(ne);const nt=(rt=F==null?void 0:F.detail)==null?void 0:rt.srcWidth,ot=(it=F==null?void 0:F.detail)==null?void 0:it.srcHeight,ze=((st=F==null?void 0:F.detail)==null?void 0:st.estimatedPose)??null;if(!ze)return;let Ue=mt(ze,nt,ot);if(s){const We=gn(ze);Ue=mt(We,nt,ot)}if(Ue)try{t(12,b=(T==null?void 0:T.evaluateFrame(U,Kt,Ue))??null)}catch(We){t(12,b=null),console.warn("Error evaluating frame",We)}}He(()=>(t(4,I=(a==null?void 0:a.startTime)??0),u=H.setupPoseEstimation(),te(),()=>{j&&clearTimeout(j)}));function he(F){I=F,t(4,I)}function ae(F){C=F,t(8,C),t(20,a)}function ie(F){w=F,t(6,w),t(20,a),t(4,I),t(28,M),t(5,y),t(24,T),t(25,U),t(26,N),t(29,j),t(31,i)}function ge(F){y=F,t(5,y)}const pe=()=>g("continue-clicked"),tt=(F,ne)=>Zn(F,ne,b,s);function Ce(F){de[F?"unshift":"push"](()=>{H=F,t(7,H)})}return n.$$set=F=>{"mirrorForEvaluation"in F&&t(0,s=F.mirrorForEvaluation),"dance"in F&&t(19,l=F.dance),"practiceActivity"in F&&t(20,a=F.practiceActivity),"pageActive"in F&&t(21,c=F.pageActive),"flipVideo"in F&&t(1,f=F.flipVideo)},n.$$.update=()=>{n.$$.dirty[0]&923795504|n.$$.dirty[1]&1&&(a!=null&&a.endTime&&I>=M||y>0&&I>=y)&&(t(6,w=!0),M===(a==null?void 0:a.endTime)?(t(26,N=(T==null?void 0:T.getPerformanceSummary(U))??null),t(13,re=(T==null?void 0:T.generateTerminalFeedback(N))??null),t(3,p="feedback")):(t(3,p="paused"),j===null&&t(29,j=window.setTimeout(K,1e3*i)))),n.$$.dirty[0]&1073741832&&r&&p==="waitWebcam"&&t(3,p="waitStart"),n.$$.dirty[0]&8&&console.log("PracticePage state",p),n.$$.dirty[0]&8&&g("stateChanged",p),n.$$.dirty[0]&5242880&&a&&t(23,P=a.activityTypes[D]),n.$$.dirty[0]&524288&&(E=l!=null&&l.bpm?60/l.bpm:1),n.$$.dirty[0]&32&&console.log("VideoDuration",y),n.$$.dirty[0]&524288&&t(9,B=tn(l)),n.$$.dirty[0]&144703560&&t(10,d=c&&(Q||!w||p==="paused")&&P==="drill"),n.$$.dirty[0]&1048576&&t(8,C=(a==null?void 0:a.playbackSpeed)??1)},[s,f,te,p,I,y,w,H,C,B,d,h,b,re,J,g,Ne,Le,S,l,a,c,D,P,T,U,N,Q,M,j,r,i,he,ae,ie,ge,pe,tt,Ce]}class co extends Ee{constructor(e){super(),Te(this,e,ao,ro,De,{mirrorForEvaluation:0,dance:19,practiceActivity:20,pageActive:21,flipVideo:1,reset:2},null,[-1,-1])}get reset(){return this.$$.ctx[2]}}function zt(n){let e,t,o=n[4].tree_name+"",r;return{c(){e=O("a"),t=L("< "),r=L(o),this.h()},l(i){e=R(i,"A",{href:!0,class:!0});var s=V(e);t=z(s,"< "),r=z(s,o),s.forEach(m),this.h()},h(){v(e,"href",n[1]),v(e,"class","button outlined back svelte-4dzpk3")},m(i,s){A(i,e,s),k(e,t),k(e,r)},p(i,s){s&2&&v(e,"href",i[1])},d(i){i&&m(e)}}}function uo(n){let e,t,o,r;t=new co({props:{dance:n[3],practiceActivity:n[5],pageActive:!0}}),t.$on("continue-clicked",n[7]),t.$on("stateChanged",n[8]);let i=!n[2]&&zt(n);return{c(){e=O("section"),ve(t.$$.fragment),o=q(),i&&i.c(),this.h()},l(s){e=R(s,"SECTION",{class:!0});var l=V(e);ye(t.$$.fragment,l),o=G(l),i&&i.l(l),l.forEach(m),this.h()},h(){v(e,"class","practiceNode svelte-4dzpk3")},m(s,l){A(s,e,l),we(t,e,null),k(e,o),i&&i.m(e,null),r=!0},p(s,[l]){s[2]?i&&(i.d(1),i=null):i?i.p(s,l):(i=zt(s),i.c(),i.m(e,null))},i(s){r||(oe(t.$$.fragment,s),r=!0)},o(s){se(t.$$.fragment,s),r=!1},d(s){s&&m(e),Se(t),i&&i.d()}}}function fo(n,e,t){let{data:o}=e;const r=o.dance,i=o.danceTree,s=o.danceTreeNode,l=Vn(r,i,s);let a="/teachlesson/"+at(i),c=Jt;const f=new Set(["countdown","playing","paused"]);let g=!1;const p=()=>ln(a),D=P=>t(0,c=P.detail);return n.$$set=P=>{"data"in P&&t(6,o=P.data)},n.$$.update=()=>{n.$$.dirty&1&&t(2,g=f.has(c))},t(1,a="/teachlesson/"+at(i)),[c,a,g,r,i,l,o,p,D]}class Eo extends Ee{constructor(e){super(),Te(this,e,fo,uo,De,{data:6})}}export{Eo as component,ko as universal};
