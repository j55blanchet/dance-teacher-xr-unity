var zt=Object.defineProperty;var Nt=(o,e,t)=>e in o?zt(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var ze=(o,e,t)=>(Nt(o,typeof e!="symbol"?e+"":e,t),t);import{D as We,P as Wt,e as ot}from"../chunks/index.04079824.js";import{g as Ut,f as qt,b as Gt,l as Yt,m as rt}from"../chunks/dances-store.f4487ea7.js";import{S as ve,i as be,s as ke,k as D,l as P,m as E,h as m,n as p,b as O,I as ce,W as nt,q as B,r as z,D as k,a as q,c as G,X as it,Y as Ee,N as se,J as Se,R as Ye,u as x,v as Mt,d as ne,f as Ot,g as te,H as Fe,K as Ke,o as Ue,t as Kt,w as ae,y as he,z as ge,A as _e,B as pe,M as Te,Z as Ze,e as st,_ as Qe,T as De,p as lt,U as Pe,V as at}from"../chunks/index.63361c4d.js";import{a as Zt,V as Qt,g as Xt}from"../chunks/VideoWithSkeleton.18165889.js";import{b as Jt,f as xt,p as $t,d as eo}from"../chunks/settings.f2d99c93.js";import{P as qe,a as Q,S as to,G as ct,M as oo}from"../chunks/mediapipe-utils.7a327831.js";import{l as ro}from"../chunks/math.c86fcf30.js";import{w as Ve,a as ut,R as Ie,P as Ne}from"../chunks/VirtualMirror.svelte_svelte_type_style_lang.c4235c89.js";function dt(o,e,t){const r=o.slice();return r[11]=e[t],r}function ft(o,e,t){const r=o.slice();return r[11]=e[t],r}function no(o){let e,t;return{c(){e=D("div"),t=B("Webcam Started")},l(r){e=P(r,"DIV",{});var n=E(e);t=z(n,"Webcam Started"),n.forEach(m)},m(r,n){O(r,e,n),k(e,t)},p:ce,d(r){r&&m(e)}}}function io(o){let e,t,r,n,s,i,l,a,c,f,g,_,I,C,w,y,j,F,L=o[3],v=[];for(let u=0;u<L.length;u+=1)v[u]=mt(ft(o,L,u));let T=o[4],A=[];for(let u=0;u<T.length;u+=1)A[u]=ht(dt(o,T,u));return{c(){e=D("label"),t=B("Video Devices"),r=q(),n=D("select");for(let u=0;u<v.length;u+=1)v[u].c();s=q(),i=D("div"),l=q(),a=D("label"),c=B("Audio Devices"),f=q(),g=D("select");for(let u=0;u<A.length;u+=1)A[u].c();_=q(),I=D("div"),C=q(),w=D("button"),y=B("Start Webcam"),this.h()},l(u){e=P(u,"LABEL",{for:!0});var h=E(e);t=z(h,"Video Devices"),h.forEach(m),r=G(u),n=P(u,"SELECT",{name:!0,class:!0});var d=E(n);for(let W=0;W<v.length;W+=1)v[W].l(d);d.forEach(m),s=G(u),i=P(u,"DIV",{class:!0}),E(i).forEach(m),l=G(u),a=P(u,"LABEL",{for:!0});var H=E(a);c=z(H,"Audio Devices"),H.forEach(m),f=G(u),g=P(u,"SELECT",{name:!0,class:!0});var R=E(g);for(let W=0;W<A.length;W+=1)A[W].l(R);R.forEach(m),_=G(u),I=P(u,"DIV",{class:!0}),E(I).forEach(m),C=G(u),w=P(u,"BUTTON",{class:!0});var Z=E(w);y=z(Z,"Start Webcam"),Z.forEach(m),this.h()},h(){p(e,"for","videoDevices"),p(n,"name","videoDevices"),p(n,"class","outlined thin"),o[6]===void 0&&it(()=>o[9].call(n)),p(i,"class","spacer svelte-1n7z142"),p(a,"for","audioDevices"),p(g,"name","audioDevices"),p(g,"class","outlined thin"),o[5]===void 0&&it(()=>o[10].call(g)),p(I,"class","spacer svelte-1n7z142"),p(w,"class","button outlined thin")},m(u,h){O(u,e,h),k(e,t),O(u,r,h),O(u,n,h);for(let d=0;d<v.length;d+=1)v[d]&&v[d].m(n,null);Ee(n,o[6],!0),O(u,s,h),O(u,i,h),O(u,l,h),O(u,a,h),k(a,c),O(u,f,h),O(u,g,h);for(let d=0;d<A.length;d+=1)A[d]&&A[d].m(g,null);Ee(g,o[5],!0),O(u,_,h),O(u,I,h),O(u,C,h),O(u,w,h),k(w,y),j||(F=[se(n,"change",o[9]),se(g,"change",o[10]),se(w,"click",o[8])],j=!0)},p(u,h){if(h&8){L=u[3];let d;for(d=0;d<L.length;d+=1){const H=ft(u,L,d);v[d]?v[d].p(H,h):(v[d]=mt(H),v[d].c(),v[d].m(n,null))}for(;d<v.length;d+=1)v[d].d(1);v.length=L.length}if(h&72&&Ee(n,u[6]),h&16){T=u[4];let d;for(d=0;d<T.length;d+=1){const H=dt(u,T,d);A[d]?A[d].p(H,h):(A[d]=ht(H),A[d].c(),A[d].m(g,null))}for(;d<A.length;d+=1)A[d].d(1);A.length=T.length}h&48&&Ee(g,u[5])},d(u){u&&m(e),u&&m(r),u&&m(n),Se(v,u),u&&m(s),u&&m(i),u&&m(l),u&&m(a),u&&m(f),u&&m(g),Se(A,u),u&&m(_),u&&m(I),u&&m(C),u&&m(w),j=!1,Ye(F)}}}function so(o){let e,t,r,n,s;return{c(){e=D("div"),t=D("div"),r=q(),n=D("p"),s=B(o[1]),this.h()},l(i){e=P(i,"DIV",{class:!0});var l=E(e);t=P(l,"DIV",{class:!0}),E(t).forEach(m),r=G(l),n=P(l,"P",{});var a=E(n);s=z(a,o[1]),a.forEach(m),l.forEach(m),this.h()},h(){p(t,"class","spinner large margin-auto"),p(e,"class","ta-center")},m(i,l){O(i,e,l),k(e,t),k(e,r),k(e,n),k(n,s)},p(i,l){l&2&&x(s,i[1])},d(i){i&&m(e)}}}function lo(o){let e,t,r,n,s,i,l=o[2]&&gt(o);return{c(){e=D("div"),t=D("button"),r=B("Start Webcam"),n=q(),l&&l.c(),this.h()},l(a){e=P(a,"DIV",{class:!0});var c=E(e);t=P(c,"BUTTON",{id:!0,class:!0});var f=E(t);r=z(f,"Start Webcam"),f.forEach(m),n=G(c),l&&l.l(c),c.forEach(m),this.h()},h(){p(t,"id","startWebcam"),p(t,"class","button outlined thin"),p(e,"class","ta-center")},m(a,c){O(a,e,c),k(e,t),k(t,r),k(e,n),l&&l.m(e,null),s||(i=se(t,"click",o[7]),s=!0)},p(a,c){a[2]?l?l.p(a,c):(l=gt(a),l.c(),l.m(e,null)):l&&(l.d(1),l=null)},d(a){a&&m(e),l&&l.d(),s=!1,i()}}}function mt(o){let e,t=o[11].label+"",r,n;return{c(){e=D("option"),r=B(t),this.h()},l(s){e=P(s,"OPTION",{});var i=E(e);r=z(i,t),i.forEach(m),this.h()},h(){e.__value=n=o[11].deviceId,e.value=e.__value},m(s,i){O(s,e,i),k(e,r)},p(s,i){i&8&&t!==(t=s[11].label+"")&&x(r,t),i&8&&n!==(n=s[11].deviceId)&&(e.__value=n,e.value=e.__value)},d(s){s&&m(e)}}}function ht(o){let e,t=o[11].label+"",r,n;return{c(){e=D("option"),r=B(t),this.h()},l(s){e=P(s,"OPTION",{});var i=E(e);r=z(i,t),i.forEach(m),this.h()},h(){e.__value=n=o[11].deviceId,e.value=e.__value},m(s,i){O(s,e,i),k(e,r)},p(s,i){i&16&&t!==(t=s[11].label+"")&&x(r,t),i&16&&n!==(n=s[11].deviceId)&&(e.__value=n,e.value=e.__value)},d(s){s&&m(e)}}}function gt(o){var l;let e,t,r,n,s=((l=o[2])==null?void 0:l.message)+"",i;return{c(){e=D("div"),t=D("p"),r=B("Failed to start webcam: "),n=D("code"),i=B(s),this.h()},l(a){e=P(a,"DIV",{class:!0});var c=E(e);t=P(c,"P",{class:!0});var f=E(t);r=z(f,"Failed to start webcam: "),n=P(f,"CODE",{});var g=E(n);i=z(g,s),g.forEach(m),f.forEach(m),c.forEach(m),this.h()},h(){p(t,"class","svelte-1n7z142"),p(e,"class","error svelte-1n7z142")},m(a,c){O(a,e,c),k(e,t),k(t,r),k(t,n),k(n,i)},p(a,c){var f;c&4&&s!==(s=((f=a[2])==null?void 0:f.message)+"")&&x(i,s)},d(a){a&&m(e)}}}function ao(o){let e;function t(s,i){if(s[0]==="start")return lo;if(s[0]==="busy")return so;if(s[0]==="devicelist")return io;if(s[0]==="success")return no}let r=t(o),n=r&&r(o);return{c(){e=D("div"),n&&n.c(),this.h()},l(s){e=P(s,"DIV",{class:!0});var i=E(e);n&&n.l(i),i.forEach(m),this.h()},h(){p(e,"class","webcamSelector svelte-1n7z142")},m(s,i){O(s,e,i),n&&n.m(e,null)},p(s,[i]){r===(r=t(s))&&n?n.p(s,i):(n&&n.d(1),n=r&&r(s),n&&(n.c(),n.m(e,null)))},i:ce,o:ce,d(s){s&&m(e),n&&n.d()}}}function co(o,e,t){let r="start",n="",s,i=[],l=[],a,c;async function f(){t(0,r="busy"),t(2,s=void 0),t(1,n="Detecting Devices...");try{const C=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),w=await navigator.mediaDevices.enumerateDevices();if(t(3,i=w.filter(y=>y.kind==="videoinput")),t(4,l=w.filter(y=>y.kind==="audioinput")),i.length===0){t(0,r="start"),t(2,s=new Error("No devices found"));return}if(i.length===1){Ve.set(C),t(0,r="success");return}t(6,c=i[0].deviceId),t(5,a=l[0].deviceId),t(0,r="devicelist")}catch(C){t(2,s=C),t(0,r="start");return}}async function g(){t(2,s=void 0),t(0,r="busy"),t(1,n="Starting Webcam...");try{const C=await navigator.mediaDevices.getUserMedia({video:{deviceId:c},audio:{deviceId:a}});Ve.set(C),t(0,r="success")}catch(C){t(2,s=C),t(0,r="devicelist")}}function _(){c=nt(this),t(6,c),t(3,i)}function I(){a=nt(this),t(5,a),t(4,l)}return[r,n,s,i,l,a,c,f,g,_,I]}class uo extends ve{constructor(e){super(),be(this,e,co,ao,ke,{})}}function fo(o){let e,t,r;return t=new uo({}),{c(){e=D("div"),he(t.$$.fragment)},l(n){e=P(n,"DIV",{});var s=E(e);ge(t.$$.fragment,s),s.forEach(m)},m(n,s){O(n,e,s),_e(t,e,null),r=!0},p:ce,i(n){r||(te(t.$$.fragment,n),r=!0)},o(n){ne(t.$$.fragment,n),r=!1},d(n){n&&m(e),pe(t)}}}function mo(o){let e,t,r,n,s;return{c(){e=D("video"),t=q(),r=D("canvas"),this.h()},l(i){e=P(i,"VIDEO",{class:!0}),E(e).forEach(m),t=G(i),r=P(i,"CANVAS",{class:!0}),E(r).forEach(m),this.h()},h(){e.autoplay=!0,p(e,"class","svelte-1b7esxu"),Te(e,"flippedHorizontal",o[1]),p(r,"class","svelte-1b7esxu"),Te(r,"flippedHorizontal",o[1])},m(i,l){O(i,e,l),o[23](e),e.muted=o[0],O(i,t,l),O(i,r,l),o[25](r),n||(s=[se(e,"play",o[7]),se(e,"loadeddata",o[6]),se(e,"volumechange",o[24])],n=!0)},p(i,l){l[0]&1&&(e.muted=i[0]),l[0]&2&&Te(e,"flippedHorizontal",i[1]),l[0]&2&&Te(r,"flippedHorizontal",i[1])},i:ce,o:ce,d(i){i&&m(e),o[23](null),i&&m(t),i&&m(r),o[25](null),n=!1,Ye(s)}}}function ho(o){let e,t,r,n;const s=[mo,fo],i=[];function l(a,c){return a[4]?0:1}return t=l(o),r=i[t]=s[t](o),{c(){e=D("div"),r.c(),this.h()},l(a){e=P(a,"DIV",{class:!0});var c=E(e);r.l(c),c.forEach(m),this.h()},h(){p(e,"class","wrapper svelte-1b7esxu")},m(a,c){O(a,e,c),i[t].m(e,null),o[26](e),n=!0},p(a,c){let f=t;t=l(a),t===f?i[t].p(a,c):(Mt(),ne(i[f],1,1,()=>{i[f]=null}),Ot(),r=i[t],r?r.p(a,c):(r=i[t]=s[t](a),r.c()),te(r,1),r.m(e,null))},i(a){n||(te(r),n=!0)},o(a){ne(r),n=!1},d(a){a&&m(e),i[t].d(),o[26](null)}}}const go=50;function _o(o,e,t){let r;Fe(o,Ve,b=>t(4,r=b));const n=-1e3,s=Ke();let{poseEstimationEnabled:i=!1}=e,{drawSkeleton:l=!1}=e,{muted:a=!0}=e,{poseEstimationCheckFunction:c=()=>!0}=e,f=null,{customDrawFn:g=null}=e,_,{poseEstimationPrimedPromise:I=new Promise(b=>_=b)}=e,C=!1,w,y,j,F,L,v;const T=new Promise(b=>v=b);let{mirrorHorizontally:A=!0}=e,u=new Date().getTime(),h=-1,d=new Date().getTime(),H=-1,R=null,Z=1,W=1,M=1,V=1,N=1,X=1;function Y(){w&&(t(19,Z=w.videoWidth),t(20,W=w.videoHeight))}const $=()=>{y&&(X>M?(t(3,y.height=N,y),t(3,y.width=N*M,y)):(t(3,y.width=V,y),t(3,y.height=V/M,y)))};function J(){return t(16,f=ut),t(16,f.onmessage=b=>{if(b.data.type===Ie.poseEstimation){if(d=new Date().getTime(),b.data.frameId===n){_==null||_();return}H=b.data.frameId,R=b.data.estimatedPose;const de={frameId:b.data.frameId,estimatedPose:b.data.estimatedPose,srcWidth:b.data.srcWidth,srcHeight:b.data.srcHeight};s("poseEstimationResult",de)}else b.data.type===Ie.error||b.data.type===Ie.resetError?(console.error("PoseEstim Error Message",b.data.type,b.data.error),b.data.frameId===h&&(h=-1,R=null)):b.data.type==Ie.resetComplete&&(console.log("Pose Estimation Reset Complete"),h=-1,R=null)},f),ut.postMessage({type:Ne.reset,frameId:new Date().getTime()}),f.ready}async function U(){if(!i||!f||!F||!y)throw new Error("Pose estimation not enabled, or not yet ready.");return console.log("Priming pose estimation"),t(8,I=new Promise(b=>_=b)),f.postMessage({type:Ne.requestPoseEstimation,frameId:n,image:F.getImageData(0,0,y.width,y.height)}),I}Ue(async()=>{i&&J(),await Kt(),$();const b=new ResizeObserver(de=>{if(!j)return;const[ie,re]=Zt(j);t(21,V=ie),t(22,N=re)});return b.observe(j),()=>{f==null||f.terminate(),b.unobserve(j)}});function le(){!w||!r||(t(2,w.srcObject=r,w),t(17,C=!0),v&&(v(),v=void 0))}let oe=0;function ue(){if(!y||!w||!r||!F)return;oe+=1;const b=w.videoWidth/w.videoHeight,de=y.width/y.height;let ie=y.width,re=y.height,fe=0,me=0;if(b>de?(re=y.width/b,me=(y.height-re)/2):(ie=re*b,fe=(y.width-ie)/2),F.drawImage(w,fe,me,ie,re),!(fe>=0&&me>=0&&ie>0&&re>0&&de>0&&b>0)){requestAnimationFrame(ue);return}const ye=new Date().getTime(),S=ye-d;if(i&&H==h&&S>go&&c()){const ee=ye-u;h=oe,s("poseEstimationFrameSent",{frameId:oe,timestampMs:ee}),f==null||f.postMessage({type:Ne.requestPoseEstimation,frameId:oe,timestampMs:ee,image:F.getImageData(fe,me,ie,re)})}if(g==null||g(F,R),!l){requestAnimationFrame(ue);return}F.save(),R&&R.length===qe.length&&(L==null||L.drawConnectors(R,Wt.POSE_CONNECTIONS),L==null||L.drawLandmarks(R,{radius:ee=>We.lerp(ee.from.z,-.15,.1,5,1)})),F.restore(),requestAnimationFrame(ue)}Ue(()=>(le(),{}));function Oe(b){ae[b?"unshift":"push"](()=>{w=b,t(2,w)})}function Re(){a=this.muted,t(0,a)}function He(b){ae[b?"unshift":"push"](()=>{y=b,t(3,y)})}function Le(b){ae[b?"unshift":"push"](()=>{j=b,t(5,j)})}return o.$$set=b=>{"poseEstimationEnabled"in b&&t(9,i=b.poseEstimationEnabled),"drawSkeleton"in b&&t(10,l=b.drawSkeleton),"muted"in b&&t(0,a=b.muted),"poseEstimationCheckFunction"in b&&t(11,c=b.poseEstimationCheckFunction),"customDrawFn"in b&&t(12,g=b.customDrawFn),"poseEstimationPrimedPromise"in b&&t(8,I=b.poseEstimationPrimedPromise),"mirrorHorizontally"in b&&t(1,A=b.mirrorHorizontally)},o.$$.update=()=>{o.$$.dirty[0]&1572864&&(M=Z/W),o.$$.dirty[0]&6291456&&(X=V/N),o.$$.dirty[0]&66048&&i&&!f&&J(),o.$$.dirty[0]&20&&r&&w&&le(),o.$$.dirty[0]&7864320&&Z&&W&&V&&N&&$(),o.$$.dirty[0]&393228&&C&&w&&y&&(t(18,F=y.getContext("2d",{willReadFrequently:!0})),L=new We(F),ue())},[a,A,w,y,r,j,Y,$,I,i,l,c,g,T,J,U,f,C,F,Z,W,V,N,Oe,Re,He,Le]}class po extends ve{constructor(e){super(),be(this,e,_o,ho,ke,{poseEstimationEnabled:9,drawSkeleton:10,muted:0,poseEstimationCheckFunction:11,customDrawFn:12,poseEstimationPrimedPromise:8,webcamStartedPromise:13,mirrorHorizontally:1,setupPoseEstimation:14,primePoseEstimation:15},null,[-1,-1])}get webcamStartedPromise(){return this.$$.ctx[13]}get setupPoseEstimation(){return this.$$.ctx[14]}get primePoseEstimation(){return this.$$.ctx[15]}}function vo({params:o}){const e=o.danceTreeId,[t,r]=Ut(e);if(!t)throw ot(404,"Dance Not found");if(!r)throw ot(404,"Dance Tree Not found");const n=qt(r,o.practiceNodeId);return{dance:t,danceTree:r,danceTreeNode:n}}const bo=!1,ur=Object.freeze(Object.defineProperty({__proto__:null,load:vo,prerender:bo},Symbol.toStringTag,{value:"Module"}));function ko(o,e,t,r){return{startTime:t.start_time,endTime:t.end_time,activityTypes:["drill"],playbackSpeed:.5}}let Ce;const wo=new Uint8Array(16);function So(){if(!Ce&&(Ce=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Ce))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ce(wo)}const K=[];for(let o=0;o<256;++o)K.push((o+256).toString(16).slice(1));function yo(o,e=0){return(K[o[e+0]]+K[o[e+1]]+K[o[e+2]]+K[o[e+3]]+"-"+K[o[e+4]]+K[o[e+5]]+"-"+K[o[e+6]]+K[o[e+7]]+"-"+K[o[e+8]]+K[o[e+9]]+"-"+K[o[e+10]]+K[o[e+11]]+K[o[e+12]]+K[o[e+13]]+K[o[e+14]]+K[o[e+15]]).toLowerCase()}const Eo=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),_t={randomUUID:Eo};function pt(o,e,t){if(_t.randomUUID&&!e&&!o)return _t.randomUUID();o=o||{};const r=o.random||(o.rng||So)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let n=0;n<16;++n)e[t+n]=r[n];return e}return yo(r)}const To={head:0,torso:1,leftarm:2,rightarm:3,leftleg:4,rightleg:5},vt=Object.freeze(["Nice Job!","Great Moves!","You're Killing It!","Awesome Dancing!","Keep It Up!","Incredible Rhythm!","Impressive Dancing!","Amazing Performance!","You've Got the Groove!","You're a Dancing Machine!","Phenomenal Footwork!","You're a Star!","Excellent Execution!","You're on Fire!","Superb Dancing!","You're a Pro!","Outstanding Performance!"]);function Do(){return vt[Math.floor(Math.random()*vt.length)]}const bt=Object.freeze(["Don't Give Up!","Keep Pushing!","You've Got This!","Stay Strong!","Keep Going!","Believe In Yourself!","Stay Focused!","Never Give Up!","You Can Do It!","Stay Motivated!","Keep Moving Forward!","Stay Resilient!","Stay Positive!","Stay Determined!","Stay Committed!","Stay Persistent!","Stay Confident!","Stay Inspired!","Stay Driven!","Stay Tenacious!"]);function Po(){return bt[Math.floor(Math.random()*bt.length)]}const Me=Object.freeze([[Q.leftShoulder,Q.rightShoulder],[Q.leftShoulder,Q.leftHip],[Q.leftHip,Q.rightHip],[Q.rightHip,Q.rightShoulder],[Q.leftShoulder,Q.leftElbow],[Q.leftElbow,Q.leftWrist],[Q.rightShoulder,Q.rightElbow],[Q.rightElbow,Q.rightWrist]]),Rt=Me.map(o=>{const[e,t]=o,[r,n]=[qe[e],qe[t]];return`${r} -> ${n}`}),Io=new Map(Rt.map((o,e)=>[o,e]));function Ht(o){return Math.pow(Math.pow(o[0],2)+Math.pow(o[1],2),.5)}function Co(o){return o.reduce((e,t)=>e+t,0)}function Ge(o){return Co(o)/o.length}function kt(o,e,t){const{x:r,y:n}=o[e],{x:s,y:i}=o[t],[l,a]=[s-r,i-n],c=Ht([l,a]);return[l/c,a/c]}function Fo(o,e){return 0}function Vo(o,e){let t=0;const r=Me.map(g=>{const[_,I]=g,[C,w]=kt(o,_,I),[y,j]=kt(e,_,I),[F,L]=[C-y,w-j];return Ht([F,L])||0});t=Ge(r);const n=2,s=0,i=5,l=0;function a(g){return ro(g,s,n,i,l)}const c=a(t),f=r.map(a);return[c,f]}class Mo{constructor(){ze(this,"tracks",new Map)}recordEvaluationFrame(e,t,r,n){var a;const s=Object.keys(n);let i;this.tracks.has(e)?i=this.tracks.get(e):(i={creationDate:new Date,frameTimes:[],recordTimesMs:[],userPoses:[],evaluation:s.reduce((c,f)=>(c[f]=[],c),{})},this.tracks.set(e,i));const l=((a=this.tracks.get(e))==null?void 0:a.frameTimes.slice(-1)[0])??-1/0;if(t<l)throw new Error("Frame time must be increasing");i.frameTimes.push(t),i.recordTimesMs.push(new Date().getTime()),i.userPoses.push(r);for(const c of s)i.evaluation[c].push(n[c])}}const Oo=new Map([[0,"torso"],[1,"torso"],[2,"torso"],[3,"torso"],[4,"leftarm"],[5,"leftarm"],[6,"rightarm"],[7,"rightarm"]]);class Ro{constructor(e){ze(this,"recorder",new Mo);this.referenceData=e}evaluateFrame(e,t,r){const n=this.referenceData.getReferencePoseAtTime(t);if(!n)return null;const[s,i]=Vo(n,r),l=Fo(),a={qijiaOverallScore:s,qijiaByVectorScores:i,julienScore:l};return this.recorder.recordEvaluationFrame(e,t,r,a),a}getPerformanceSummary(e){const t=this.recorder.tracks.get(e);if(!t)return null;const r=Me.map((g,_)=>{const I=Rt[_],C=t.evaluation.qijiaByVectorScores.map(y=>y[_]),w=Ge(C);return[I,w]}),n=Ge(t.evaluation.qijiaOverallScore),s=new Map(r),i=t.frameTimes.length,l=(t.recordTimesMs[i-1]-t.recordTimesMs[0])/1e3,a=t.frameTimes[i-1]-t.frameTimes[0],c=i/a,f=i/l;return{frameCount:i,danceTimeDurationSecs:a,realtimeDurationSecs:l,danceTimeFps:c,realTimeFps:f,qijiaOverallScore:n,qijiaByVectorScores:s}}generateTerminalFeedback(e){if(!e)return{headline:"Try Again?",subHeadline:"We don't have any feedback for you.",suggestedAction:"repeat"};const{qijiaOverallScore:t,qijiaByVectorScores:r}=e;let n,s,i,l,a;const[c,f]=[...r.keys()].map(g=>{const _=Io.get(g);if(_===void 0)throw new Error("Unexpected vector name: "+g);const I=r.get(g);if(I===void 0)throw new Error("Unable to retrieve score for "+g);return[_,I]}).reduce(([g,_],[I,C])=>C<_?[I,C]:[g,_],[-1,1/0]);if(t>$evaluation_GoodBadTrialThreshold)n=Do(),s="You did great on that trial! Would you like to move on now?",i="next",a=[...Object.keys(To)];else{n=Po(),s="Want to try again?",i="repeat";const g=Oo.get(c);if(!g)throw new Error("Unexpected vector index: "+c);l=[g]}return{headline:n,subHeadline:s,score:{achieved:t,maximumPossible:5},suggestedAction:i,incorrectBodyPartsToHighlight:l,correctBodyPartsToHighlight:a}}}const Ho=Me.map(([o,e])=>({start:o,end:e}));let Lt=0;Jt.subscribe(o=>{Lt=o});let At=0;xt.subscribe(o=>{At=o});function Lo(o,e){const t=e==null?void 0:e.qijiaByVectorScores[o.index??-1];return t===void 0?"white":t>=Lt?"green":t>=At?"yellow":"red"}function Ao(o,e,t,r=!1){if(!e)return;r&&(e=to(e)),new We(o).drawConnectors(e,Ho,{color:s=>Lo(s,t),lineWidth:4})}const jo=""+new URL("../assets/metronome.208d4270.mp3",import.meta.url).href;function wt(o,e,t){const r=o.slice();return r[7]=e[t],r[9]=t,r}function St(o,e,t){const r=o.slice();return r[10]=e[t],r[9]=t,r}function yt(o){let e;return{c(){e=Ze("path"),this.h()},l(t){e=Qe(t,"path",{d:!0,fill:!0,stroke:!0,"stroke-width":!0}),E(e).forEach(m),this.h()},h(){p(e,"d",o[5][o[10]]),p(e,"fill",o[1]),p(e,"stroke",o[2]),p(e,"stroke-width","0.5")},m(t,r){O(t,e,r)},p(t,r){r&2&&p(e,"fill",t[1]),r&4&&p(e,"stroke",t[2])},d(t){t&&m(e)}}}function Et(o){let e,t,r,n;return{c(){e=Ze("path"),this.h()},l(s){e=Qe(s,"path",{d:!0,fill:!0,stroke:!0,"stroke-width":!0}),E(e).forEach(m),this.h()},h(){p(e,"d",t=o[5][o[7].bodyPart]),p(e,"fill",r=o[7].fillColor??o[3]),p(e,"stroke",n=o[7].outlineColor??o[4]),p(e,"stroke-width","0.5")},m(s,i){O(s,e,i)},p(s,i){i&1&&t!==(t=s[5][s[7].bodyPart])&&p(e,"d",t),i&9&&r!==(r=s[7].fillColor??s[3])&&p(e,"fill",r),i&17&&n!==(n=s[7].outlineColor??s[4])&&p(e,"stroke",n)},d(s){s&&m(e)}}}function Bo(o){let e,t,r=o[6],n=[];for(let l=0;l<r.length;l+=1)n[l]=yt(St(o,r,l));let s=o[0],i=[];for(let l=0;l<s.length;l+=1)i[l]=Et(wt(o,s,l));return{c(){e=Ze("svg");for(let l=0;l<n.length;l+=1)n[l].c();t=st();for(let l=0;l<i.length;l+=1)i[l].c();this.h()},l(l){e=Qe(l,"svg",{xmlns:!0,viewBox:!0,preserveAspectRatio:!0,class:!0});var a=E(e);for(let c=0;c<n.length;c+=1)n[c].l(a);t=st();for(let c=0;c<i.length;c+=1)i[c].l(a);a.forEach(m),this.h()},h(){p(e,"xmlns","http://www.w3.org/2000/svg"),p(e,"viewBox","0 -1 14 55"),p(e,"preserveAspectRatio","xMinYMin slice"),p(e,"class","svelte-1dgy757")},m(l,a){O(l,e,a);for(let c=0;c<n.length;c+=1)n[c]&&n[c].m(e,null);k(e,t);for(let c=0;c<i.length;c+=1)i[c]&&i[c].m(e,null)},p(l,[a]){if(a&102){r=l[6];let c;for(c=0;c<r.length;c+=1){const f=St(l,r,c);n[c]?n[c].p(f,a):(n[c]=yt(f),n[c].c(),n[c].m(e,t))}for(;c<n.length;c+=1)n[c].d(1);n.length=r.length}if(a&57){s=l[0];let c;for(c=0;c<s.length;c+=1){const f=wt(l,s,c);i[c]?i[c].p(f,a):(i[c]=Et(f),i[c].c(),i[c].m(e,null))}for(;c<i.length;c+=1)i[c].d(1);i.length=s.length}},i:ce,o:ce,d(l){l&&m(e),Se(n,l),Se(i,l)}}}function zo(o,e,t){let{highlights:r=[]}=e,{stdFillColor:n="#000"}=e,{stdOutlineColor:s="#AAA"}=e,{highlightFillColor:i="#000"}=e,{highlightOutlineColor:l="#77F"}=e;const a={head:"M 7 0 C 9.5 0 10 2 10 4 S 8.5 8 7 8 S 4 6 4 4 S 4.5 0 7 0 Z",torso:"M 7 10 C 10 10 12 10 12 11 S 10.5 18 10.5 21 S 11 26 11 27 S 9 28 7 28 S 3 28 3 27 S 3.5 24 3.5 21 S 2 12 2 11 S 4 10 7 10 Z",leftleg:"M 8 29 L 8.5 40 L 8.25 50 C 8.25 51 8.35 52 8.5 53.5 C 9.5 53.5 10.75 53.5 10.5 53 L 9.5 51 L 10.5 41 L 10.5 40 L 11 29 C 11 28.25 8 28.25 8 29 Z",rightleg:"M 6 29 L 5.5 40 L 5.75 50 C 5.75 51 5.65 52 5.5 53.5 C 4.5 53.5 3.25 53.5 3.5 53 L 4.5 51 L 3.5 41 L 3.5 40 L 3 29 C 3 28.25 6 28.25 6 29 Z",leftarm:"M 12.25 11 C 12.75 11.5 12.75 12 13 13 C 13.5 16 13.75 18 13.75 20 S 13 25 13 26 S 13.2 27 13.2 28 S 12 29 12 28.5 S 11.75 27 12 26 C 12.25 25 12 22 12.5 20 C 12.1 14 11.5 15 12.2 11 Z",rightarm:"M 1.75 11 C 1.25 11.5 1.25 12 1 13 C 0.5 16 0.25 18 0.25 20 S 1 25 1 26 S 0.8 27 0.8 28 S 2 29 2 28.5 S 2.25 27 2 26 C 1.75 25 2 22 1.5 20 C 1.9 14 2.5 15 1.8 11 Z"},c=Object.keys(a);return o.$$set=f=>{"highlights"in f&&t(0,r=f.highlights),"stdFillColor"in f&&t(1,n=f.stdFillColor),"stdOutlineColor"in f&&t(2,s=f.stdOutlineColor),"highlightFillColor"in f&&t(3,i=f.highlightFillColor),"highlightOutlineColor"in f&&t(4,l=f.highlightOutlineColor)},[r,n,s,i,l,a,c]}class No extends ve{constructor(e){super(),be(this,e,zo,Bo,ke,{highlights:0,stdFillColor:1,stdOutlineColor:2,highlightFillColor:3,highlightOutlineColor:4})}}function Tt(o,e,t){const r=o.slice();return r[8]=e[t],r}function Dt(o){let e,t,r,n=o[0].score.achieved.toFixed(2)+"",s,i,l=o[0].score.maximumPossible.toFixed(2)+"",a;return{c(){e=D("p"),t=D("code"),r=B("Score: "),s=B(n),i=B(" / "),a=B(l),this.h()},l(c){e=P(c,"P",{class:!0});var f=E(e);t=P(f,"CODE",{});var g=E(t);r=z(g,"Score: "),s=z(g,n),i=z(g," / "),a=z(g,l),g.forEach(m),f.forEach(m),this.h()},h(){p(e,"class","svelte-1xujmdv")},m(c,f){O(c,e,f),k(e,t),k(t,r),k(t,s),k(t,i),k(t,a)},p(c,f){f&1&&n!==(n=c[0].score.achieved.toFixed(2)+"")&&x(s,n),f&1&&l!==(l=c[0].score.maximumPossible.toFixed(2)+"")&&x(a,l)},d(c){c&&m(e)}}}function Pt(o){let e,t,r=o[8]+"",n,s;return{c(){e=D("p"),t=B("Try focusing on your "),n=B(r),s=B(" next time."),this.h()},l(i){e=P(i,"P",{class:!0});var l=E(e);t=z(l,"Try focusing on your "),n=z(l,r),s=z(l," next time."),l.forEach(m),this.h()},h(){p(e,"class","svelte-1xujmdv")},m(i,l){O(i,e,l),k(e,t),k(e,n),k(e,s)},p(i,l){l&1&&r!==(r=i[8]+"")&&x(n,r)},d(i){i&&m(e)}}}function Wo(o){var H,R,Z,W;let e,t,r=((H=o[0])==null?void 0:H.headline)+"",n,s,i,l=((R=o[0])==null?void 0:R.subHeadline)+"",a,c,f,g,_,I,C,w,y,j,F,L,v,T,A,u=((Z=o[0])==null?void 0:Z.score)&&Dt(o),h=((W=o[0])==null?void 0:W.incorrectBodyPartsToHighlight)??[],d=[];for(let M=0;M<h.length;M+=1)d[M]=Pt(Tt(o,h,M));return I=new No({props:{highlights:o[3]}}),{c(){e=D("div"),t=D("h2"),n=B(r),s=q(),i=D("p"),a=B(l),c=q(),u&&u.c(),f=q();for(let M=0;M<d.length;M+=1)d[M].c();g=q(),_=D("div"),he(I.$$.fragment),C=q(),w=D("button"),y=B(o[1]),j=q(),F=D("button"),L=B(o[2]),this.h()},l(M){e=P(M,"DIV",{class:!0});var V=E(e);t=P(V,"H2",{class:!0});var N=E(t);n=z(N,r),N.forEach(m),s=G(V),i=P(V,"P",{class:!0});var X=E(i);a=z(X,l),X.forEach(m),c=G(V),u&&u.l(V),f=G(V);for(let U=0;U<d.length;U+=1)d[U].l(V);g=G(V),_=P(V,"DIV",{class:!0});var Y=E(_);ge(I.$$.fragment,Y),Y.forEach(m),C=G(V),w=P(V,"BUTTON",{class:!0});var $=E(w);y=z($,o[1]),$.forEach(m),j=G(V),F=P(V,"BUTTON",{class:!0});var J=E(F);L=z(J,o[2]),J.forEach(m),V.forEach(m),this.h()},h(){p(t,"class","svelte-1xujmdv"),p(i,"class","sub-headline svelte-1xujmdv"),p(_,"class","skeleton svelte-1xujmdv"),p(w,"class","outlined"),p(F,"class","outlined thin"),p(e,"class","feedbackForm svelte-1xujmdv")},m(M,V){O(M,e,V),k(e,t),k(t,n),k(e,s),k(e,i),k(i,a),k(e,c),u&&u.m(e,null),k(e,f);for(let N=0;N<d.length;N+=1)d[N]&&d[N].m(e,null);k(e,g),k(e,_),_e(I,_,null),k(e,C),k(e,w),k(w,y),k(e,j),k(e,F),k(F,L),v=!0,T||(A=[se(w,"click",o[4]),se(F,"click",o[5])],T=!0)},p(M,[V]){var X,Y,$,J;if((!v||V&1)&&r!==(r=((X=M[0])==null?void 0:X.headline)+"")&&x(n,r),(!v||V&1)&&l!==(l=((Y=M[0])==null?void 0:Y.subHeadline)+"")&&x(a,l),($=M[0])!=null&&$.score?u?u.p(M,V):(u=Dt(M),u.c(),u.m(e,f)):u&&(u.d(1),u=null),V&1){h=((J=M[0])==null?void 0:J.incorrectBodyPartsToHighlight)??[];let U;for(U=0;U<h.length;U+=1){const le=Tt(M,h,U);d[U]?d[U].p(le,V):(d[U]=Pt(le),d[U].c(),d[U].m(e,g))}for(;U<d.length;U+=1)d[U].d(1);d.length=h.length}const N={};V&8&&(N.highlights=M[3]),I.$set(N),(!v||V&2)&&x(y,M[1]),(!v||V&4)&&x(L,M[2])},i(M){v||(te(I.$$.fragment,M),v=!0)},o(M){ne(I.$$.fragment,M),v=!1},d(M){M&&m(e),u&&u.d(),Se(d,M),pe(I),T=!1,Ye(A)}}}function Uo(o,e,t){const r=Ke();let{feedback:n=null}=e,s=!1,i="",l="";function a(){r(s?"repeat-clicked":"continue-clicked")}function c(){r(s?"continue-clicked":"repeat-clicked")}let f=[];return o.$$set=g=>{"feedback"in g&&t(0,n=g.feedback)},o.$$.update=()=>{o.$$.dirty&1&&t(6,s=(n==null?void 0:n.suggestedAction)==="repeat"),o.$$.dirty&64&&t(1,i=s?"Do Again ðŸ”":"Continue âž¡ï¸"),o.$$.dirty&64&&t(2,l=s?"Continue âž¡ï¸":"Do Again ðŸ”"),o.$$.dirty&1&&t(3,f=[...((n==null?void 0:n.incorrectBodyPartsToHighlight)??[]).map(g=>({bodyPart:g,outlineColor:"#F00"})),...((n==null?void 0:n.correctBodyPartsToHighlight)??[]).map(g=>({bodyPart:g,outlineColor:"#0F0"}))])},[n,i,l,f,a,c,s]}class qo extends ve{constructor(e){super(),be(this,e,Uo,Wo,ke,{feedback:0})}}function Go(o){let e,t;return{c(){e=D("source"),this.h()},l(r){e=P(r,"SOURCE",{src:!0,type:!0}),this.h()},h(){at(e.src,t=o[9])||p(e,"src",t),p(e,"type","video/mp4")},m(r,n){O(r,e,n)},p(r,n){n[0]&512&&!at(e.src,t=r[9])&&p(e,"src",t)},d(r){r&&m(e)}}}function It(o){let e,t,r;return{c(){e=D("div"),t=D("span"),r=B(o[14]),this.h()},l(n){e=P(n,"DIV",{class:!0});var s=E(e);t=P(s,"SPAN",{class:!0});var i=E(t);r=z(i,o[14]),i.forEach(m),s.forEach(m),this.h()},h(){p(t,"class","count svelte-11jy3qp"),p(e,"class","countdown svelte-11jy3qp")},m(n,s){O(n,e,s),k(e,t),k(t,r)},p(n,s){s[0]&16384&&x(r,n[14])},d(n){n&&m(e)}}}function Ct(o){let e,t,r;return t=new qo({props:{feedback:o[13]}}),t.$on("repeat-clicked",o[2]),t.$on("continue-clicked",o[36]),{c(){e=D("div"),he(t.$$.fragment),this.h()},l(n){e=P(n,"DIV",{class:!0});var s=E(e);ge(t.$$.fragment,s),s.forEach(m),this.h()},h(){p(e,"class","svelte-11jy3qp")},m(n,s){O(n,e,s),_e(t,e,null),r=!0},p(n,s){const i={};s[0]&8192&&(i.feedback=n[13]),t.$set(i)},i(n){r||(te(t.$$.fragment,n),r=!0)},o(n){ne(t.$$.fragment,n),r=!1},d(n){n&&m(e),pe(t)}}}function Ft(o){let e,t,r;return{c(){e=D("div"),t=D("div"),r=B("Loading..."),this.h()},l(n){e=P(n,"DIV",{class:!0});var s=E(e);t=P(s,"DIV",{class:!0});var i=E(t);r=z(i,"Loading..."),i.forEach(m),s.forEach(m),this.h()},h(){p(t,"class","label svelte-11jy3qp"),p(e,"class","loading outlined thick svelte-11jy3qp")},m(n,s){O(n,e,s),k(e,t),k(t,r)},d(n){n&&m(e)}}}function Yo(o){let e,t,r,n,s,i,l,a,c,f,g,_,I,C;function w(h){o[32](h)}function y(h){o[33](h)}function j(h){o[34](h)}function F(h){o[35](h)}let L={flipHorizontal:o[1],fitToFlexbox:Ko,poseData:o[11],drawSkeleton:Qo,$$slots:{default:[Go]},$$scope:{ctx:o}};o[4]!==void 0&&(L.currentTime=o[4]),o[8]!==void 0&&(L.playbackRate=o[8]),o[6]!==void 0&&(L.paused=o[6]),o[5]!==void 0&&(L.duration=o[5]),r=new Qt({props:L}),ae.push(()=>De(r,"currentTime",w)),ae.push(()=>De(r,"playbackRate",y)),ae.push(()=>De(r,"paused",j)),ae.push(()=>De(r,"duration",F));let v=o[14]>=0&&It(o),T=o[3]==="feedback"&&Ct(o),A={poseEstimationEnabled:o[10],drawSkeleton:!1,poseEstimationCheckFunction:o[17],customDrawFn:o[37]};_=new po({props:A}),o[38](_),_.$on("poseEstimationFrameSent",o[16]),_.$on("poseEstimationResult",o[18]);let u=o[3]==="waitStart"&&Ft();return{c(){e=D("section"),t=D("div"),he(r.$$.fragment),a=q(),v&&v.c(),c=q(),T&&T.c(),f=q(),g=D("div"),he(_.$$.fragment),I=q(),u&&u.c(),this.h()},l(h){e=P(h,"SECTION",{class:!0});var d=E(e);t=P(d,"DIV",{class:!0});var H=E(t);ge(r.$$.fragment,H),a=G(H),v&&v.l(H),H.forEach(m),c=G(d),T&&T.l(d),f=G(d),g=P(d,"DIV",{class:!0});var R=E(g);ge(_.$$.fragment,R),I=G(R),u&&u.l(R),R.forEach(m),d.forEach(m),this.h()},h(){p(t,"class","svelte-11jy3qp"),p(g,"class","svelte-11jy3qp"),lt(g,"display",o[3]==="feedback"?"none":"flex"),p(e,"class","practicePage svelte-11jy3qp")},m(h,d){O(h,e,d),k(e,t),_e(r,t,null),k(t,a),v&&v.m(t,null),k(e,c),T&&T.m(e,null),k(e,f),k(e,g),_e(_,g,null),k(g,I),u&&u.m(g,null),C=!0},p(h,d){const H={};d[0]&2&&(H.flipHorizontal=h[1]),d[0]&2048&&(H.poseData=h[11]),d[0]&512|d[1]&524288&&(H.$$scope={dirty:d,ctx:h}),!n&&d[0]&16&&(n=!0,H.currentTime=h[4],Pe(()=>n=!1)),!s&&d[0]&256&&(s=!0,H.playbackRate=h[8],Pe(()=>s=!1)),!i&&d[0]&64&&(i=!0,H.paused=h[6],Pe(()=>i=!1)),!l&&d[0]&32&&(l=!0,H.duration=h[5],Pe(()=>l=!1)),r.$set(H),h[14]>=0?v?v.p(h,d):(v=It(h),v.c(),v.m(t,null)):v&&(v.d(1),v=null),h[3]==="feedback"?T?(T.p(h,d),d[0]&8&&te(T,1)):(T=Ct(h),T.c(),te(T,1),T.m(e,f)):T&&(Mt(),ne(T,1,1,()=>{T=null}),Ot());const R={};d[0]&1024&&(R.poseEstimationEnabled=h[10]),d[0]&4097&&(R.customDrawFn=h[37]),_.$set(R),h[3]==="waitStart"?u||(u=Ft(),u.c(),u.m(g,null)):u&&(u.d(1),u=null),d[0]&8&&lt(g,"display",h[3]==="feedback"?"none":"flex")},i(h){C||(te(r.$$.fragment,h),te(T),te(_.$$.fragment,h),C=!0)},o(h){ne(r.$$.fragment,h),ne(T),ne(_.$$.fragment,h),C=!1},d(h){h&&m(e),pe(r),v&&v.d(),T&&T.d(),o[38](null),pe(_),u&&u.d()}}}const jt="waitWebcam";let Ko=!0;const Zo=10;let Qo=!1;async function we(o){return new Promise(e=>{setTimeout(e,(o??1)*1e3)})}function Xo(o,e,t){let r,n,s;Fe(o,$t,S=>t(43,r=S)),Fe(o,Ve,S=>t(30,n=S)),Fe(o,eo,S=>t(31,s=S));let{mirrorForEvaluation:i=!0}=e,{dance:l}=e,{practiceActivity:a}=e,{pageActive:c=!1}=e,{flipVideo:f=!1}=e;const g=Ke();let _=jt,I=0,C="watch",w=1,y=new Audio(jo),j,F=0,L=1,v=0,T=!0,A="",u=!1,h=null,d=null,H=null,R=null,Z=pt(),W=null,M=null,V=-1,N=!1,X=(a==null?void 0:a.endTime)??0,Y=null;function $(){t(29,Y=null),t(28,X=(a==null?void 0:a.endTime)??v),t(6,T=!1),t(3,_="playing")}function J(){y.currentTime=0,y.play()}async function U(){N||(t(6,T=!0),t(4,F=(a==null?void 0:a.startTime)??0),t(25,Z=pt()),u&&(console.log("Triggering pose estimation priming"),await j.primePoseEstimation()),t(3,_="countdown"),t(27,N=!0),await we(w),t(14,V=5),J(),await we(w),t(14,V=6),J(),await we(w),t(14,V=7),J(),await we(w),t(14,V=8),J(),await we(w),t(3,_="playing"),t(14,V=-1),t(6,T=!1),t(27,N=!1))}async function le(){Y!==null&&clearTimeout(Y),t(22,I=0),t(3,_="waitWebcam"),t(12,H=null),t(6,T=!0),t(4,F=(a==null?void 0:a.startTime)??0);const S=((a==null?void 0:a.endTime)??v)-F;t(28,X=r?F+S/2:(a==null?void 0:a.endTime)??v),t(11,d=await Yt(l)),await j.webcamStartedPromise,t(3,_="waitStart"),t(24,R=new Ro(d)),await h,U()}let oe=new Map,ue=-1,Oe=new Date;const Re=1e3/Zo;function He(S){oe.set(S.detail.frameId,F),ue=F}function Le(){return!(ue===F&&Oe.getTime()>Date.now()-Re)}function b(S){var $e,et,tt;if(_!=="playing"&&_!=="paused")return;if(!d){console.log("No dance pose information",S);return}const ee=S.detail.frameId;if(!oe.has(ee)){console.log(`No matching correspondance for ${ee}`,S,"current correspondances: ",oe);return}const Bt=oe.get(ee);oe.delete(ee);const Je=($e=S==null?void 0:S.detail)==null?void 0:$e.srcWidth,xe=(et=S==null?void 0:S.detail)==null?void 0:et.srcHeight,Ae=((tt=S==null?void 0:S.detail)==null?void 0:tt.estimatedPose)??null;if(!Ae)return;let je=ct(Ae,Je,xe);if(i){const Be=oo(Ae);je=ct(Be,Je,xe)}if(je)try{t(12,H=(R==null?void 0:R.evaluateFrame(Z,Bt,je))??null)}catch(Be){t(12,H=null),console.warn("Error evaluating frame",Be)}}Ue(()=>(t(4,F=(a==null?void 0:a.startTime)??0),h=j.setupPoseEstimation(),le(),()=>{Y&&clearTimeout(Y)}));function de(S){F=S,t(4,F)}function ie(S){L=S,t(8,L),t(20,a)}function re(S){T=S,t(6,T),t(20,a),t(4,F),t(28,X),t(5,v),t(24,R),t(25,Z),t(26,W),t(29,Y),t(31,s)}function fe(S){v=S,t(5,v)}const me=()=>g("continue-clicked"),Xe=(S,ee)=>Ao(S,ee,H,i);function ye(S){ae[S?"unshift":"push"](()=>{j=S,t(7,j)})}return o.$$set=S=>{"mirrorForEvaluation"in S&&t(0,i=S.mirrorForEvaluation),"dance"in S&&t(19,l=S.dance),"practiceActivity"in S&&t(20,a=S.practiceActivity),"pageActive"in S&&t(21,c=S.pageActive),"flipVideo"in S&&t(1,f=S.flipVideo)},o.$$.update=()=>{o.$$.dirty[0]&923795504|o.$$.dirty[1]&1&&(a!=null&&a.endTime&&F>=X||v>0&&F>=v)&&(t(6,T=!0),X===(a==null?void 0:a.endTime)?(t(26,W=(R==null?void 0:R.getPerformanceSummary(Z))??null),t(13,M=(R==null?void 0:R.generateTerminalFeedback(W))??null),t(3,_="feedback")):(t(3,_="paused"),Y===null&&t(29,Y=window.setTimeout($,1e3*s)))),o.$$.dirty[0]&1073741832&&n&&_==="waitWebcam"&&t(3,_="waitStart"),o.$$.dirty[0]&8&&console.log("PracticePage state",_),o.$$.dirty[0]&8&&g("stateChanged",_),o.$$.dirty[0]&5242880&&a&&t(23,C=a.activityTypes[I]),o.$$.dirty[0]&524288&&(w=l!=null&&l.bpm?60/l.bpm:1),o.$$.dirty[0]&32&&console.log("VideoDuration",v),o.$$.dirty[0]&524288&&t(9,A=Gt(l)),o.$$.dirty[0]&144703560&&t(10,u=c&&(N||!T||_==="paused")&&C==="drill"),o.$$.dirty[0]&1048576&&t(8,L=(a==null?void 0:a.playbackSpeed)??1)},[i,f,le,_,F,v,T,j,L,A,u,d,H,M,V,g,He,Le,b,l,a,c,I,C,R,Z,W,N,X,Y,n,s,de,ie,re,fe,me,Xe,ye]}class Jo extends ve{constructor(e){super(),be(this,e,Xo,Yo,ke,{mirrorForEvaluation:0,dance:19,practiceActivity:20,pageActive:21,flipVideo:1,reset:2},null,[-1,-1])}get reset(){return this.$$.ctx[2]}}function Vt(o){let e,t,r=o[4].tree_name+"",n;return{c(){e=D("a"),t=B("< "),n=B(r),this.h()},l(s){e=P(s,"A",{href:!0,class:!0});var i=E(e);t=z(i,"< "),n=z(i,r),i.forEach(m),this.h()},h(){p(e,"href",o[1]),p(e,"class","button outlined back svelte-4dzpk3")},m(s,i){O(s,e,i),k(e,t),k(e,n)},p(s,i){i&2&&p(e,"href",s[1])},d(s){s&&m(e)}}}function xo(o){let e,t,r,n;t=new Jo({props:{dance:o[3],practiceActivity:o[5],pageActive:!0}}),t.$on("continue-clicked",o[7]),t.$on("stateChanged",o[8]);let s=!o[2]&&Vt(o);return{c(){e=D("section"),he(t.$$.fragment),r=q(),s&&s.c(),this.h()},l(i){e=P(i,"SECTION",{class:!0});var l=E(e);ge(t.$$.fragment,l),r=G(l),s&&s.l(l),l.forEach(m),this.h()},h(){p(e,"class","practiceNode svelte-4dzpk3")},m(i,l){O(i,e,l),_e(t,e,null),k(e,r),s&&s.m(e,null),n=!0},p(i,[l]){i[2]?s&&(s.d(1),s=null):s?s.p(i,l):(s=Vt(i),s.c(),s.m(e,null))},i(i){n||(te(t.$$.fragment,i),n=!0)},o(i){ne(t.$$.fragment,i),n=!1},d(i){i&&m(e),pe(t),s&&s.d()}}}function $o(o,e,t){let{data:r}=e;const n=r.dance,s=r.danceTree,i=r.danceTreeNode,l=ko(n,s,i);let a="/teachlesson/"+rt(s),c=jt;const f=new Set(["countdown","playing","paused"]);let g=!1;const _=()=>Xt(a),I=C=>t(0,c=C.detail);return o.$$set=C=>{"data"in C&&t(6,r=C.data)},o.$$.update=()=>{o.$$.dirty&1&&t(2,g=f.has(c))},t(1,a="/teachlesson/"+rt(s)),[c,a,g,n,s,l,r,_,I]}class dr extends ve{constructor(e){super(),be(this,e,$o,xo,ke,{data:6})}}export{dr as component,ur as universal};
